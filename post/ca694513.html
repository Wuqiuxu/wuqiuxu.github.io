<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>django框架 | 妙妙屋</title><meta name="author" content="Wuqiuxu"><meta name="copyright" content="Wuqiuxu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="一、Web应用程序处理流程 Web应用程序的本质   接收并解析HTTP请求，获取具体的请求信息 处理本次HTTP请求，即完成本次请求的业务逻辑处理 构造并返回处理结果——HTTP响应   Web程序框架的意义   用于搭建Web应用程序 免去不同Web应用相同代码部分的重复编写，只需关心Web应用核心的业务逻辑实现     二、Django简介1. Django简介 Django，是用pytho">
<meta property="og:type" content="article">
<meta property="og:title" content="django框架">
<meta property="og:url" content="http://example.com/post/ca694513.html">
<meta property="og:site_name" content="妙妙屋">
<meta property="og:description" content="一、Web应用程序处理流程 Web应用程序的本质   接收并解析HTTP请求，获取具体的请求信息 处理本次HTTP请求，即完成本次请求的业务逻辑处理 构造并返回处理结果——HTTP响应   Web程序框架的意义   用于搭建Web应用程序 免去不同Web应用相同代码部分的重复编写，只需关心Web应用核心的业务逻辑实现     二、Django简介1. Django简介 Django，是用pytho">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/django.png">
<meta property="article:published_time" content="2023-06-16T07:21:43.000Z">
<meta property="article:modified_time" content="2023-06-20T14:40:28.983Z">
<meta property="article:author" content="Wuqiuxu">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://example.com/img/Psyduck.png"><link rel="shortcut icon" href="/img/Psyduck.png"><link rel="canonical" href="http://example.com/post/ca694513.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?https://hm.baidu.com/hm.js?5bacdf5f7eaeeca2624a134c063a96c0";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"V9Z0XHM9DP","apiKey":"fa27b7a048b6171f01dadf98cba8a3fd","indexName":"blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":0,"languages":{"author":"作者: Wuqiuxu","link":"链接: ","source":"来源: 妙妙屋","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'django框架',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-20 22:40:28'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4125923_iosihe4hf8q.css"><link rel="stylesheet" href="/css/myCss.css"><script src="https://code.jquery.com/jquery-1.7.2.min.js"></script><script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/planet/"><i class="fa-fw fa-solid fa-book"></i><span> 知识星球</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 创作集</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/crawler/"><i class="fa-fw fa-solid fa-spider"></i><span> 爬虫</span></a></li><li><a class="site-page child" href="/datadev/"><i class="fa-fw fa-solid fa-database"></i><span> 数据开发</span></a></li><li><a class="site-page child" href="/dataanal/"><i class="fa-fw fa-solid fa-chart-simple"></i><span> 数据分析</span></a></li><li><a class="site-page child" href="/improve/"><i class="fa-fw fa-solid fa-clock"></i><span> 工作提效</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 归档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-book"></i><span> 文档&amp;工具</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-solid fa-user"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('/img/default.png')"><nav id="nav"><span id="blog-info"><a href="/" title="妙妙屋"><img class="site-icon" src="/img/Psyduck.png"/><span class="site-name">妙妙屋</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/planet/"><i class="fa-fw fa-solid fa-book"></i><span> 知识星球</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 创作集</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/crawler/"><i class="fa-fw fa-solid fa-spider"></i><span> 爬虫</span></a></li><li><a class="site-page child" href="/datadev/"><i class="fa-fw fa-solid fa-database"></i><span> 数据开发</span></a></li><li><a class="site-page child" href="/dataanal/"><i class="fa-fw fa-solid fa-chart-simple"></i><span> 数据分析</span></a></li><li><a class="site-page child" href="/improve/"><i class="fa-fw fa-solid fa-clock"></i><span> 工作提效</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 归档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-book"></i><span> 文档&amp;工具</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-solid fa-user"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">django框架</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-16T07:21:43.000Z" title="发表于 2023-06-16 15:21:43">2023-06-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-20T14:40:28.983Z" title="更新于 2023-06-20 22:40:28">2023-06-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/web%E5%BC%80%E5%8F%91/">web开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>59分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="django框架"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一、Web应用程序处理流程"><a href="#一、Web应用程序处理流程" class="headerlink" title="一、Web应用程序处理流程"></a>一、Web应用程序处理流程</h1><ul>
<li><p>Web应用程序的本质</p>
</li>
<li><ul>
<li>接收并解析HTTP请求，获取具体的请求信息</li>
<li>处理本次HTTP请求，即完成本次请求的<strong>业务逻辑处理</strong></li>
<li>构造并返回处理结果——HTTP响应</li>
</ul>
</li>
<li><p>Web程序框架的意义</p>
</li>
<li><ul>
<li>用于搭建Web应用程序</li>
<li>免去不同Web应用相同代码部分的重复编写，只需关心Web应用<strong>核心的业务逻辑</strong>实现</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1664959238638-1c2eb44f-59c3-4153-a5c8-f3d50ee71fab.png" alt="img"></p>
<h1 id="二、Django简介"><a href="#二、Django简介" class="headerlink" title="二、Django简介"></a>二、Django简介</h1><h2 id="1-Django简介"><a href="#1-Django简介" class="headerlink" title="1. Django简介"></a>1. Django简介</h2><ul>
<li>Django，是用python语言写的开源web开发框架，并遵循MVC设计，劳伦斯出版集团为了开发以新闻内容为主的网站，而开发出来了这个框架，于2005年7月在BSD许可证下发布</li>
<li>Django这个名称来源于比利时的爵士音乐家DjangoReinhardt，他是一个吉普赛人，主要以演奏吉它为主，还演奏过小提琴等</li>
<li>由于Django在近年来的迅速发展，应用越来越广泛，被著名IT开发杂志SDTimes评选为2013SDTimes100，位列”API、库和框架”分类第6位，被认为是该领域的佼佼者</li>
<li>Django的主要目的是简便、快速的开发数据库驱动的网站。它强调代码复用，多个组件可以很方便的以”插件”形式服务于整个框架</li>
<li>Django有许多功能强大的第三方插件，甚至可以很方便的开发出自己的工具包，这使得Django具有很强的可扩展性</li>
<li>Django强调快速开发和DRY(DoNotRepeatYourself)原则</li>
</ul>
<h2 id="2-Django的特点"><a href="#2-Django的特点" class="headerlink" title="2. Django的特点"></a>2. Django的特点</h2><p><strong>（1）重量级框架</strong></p>
<ul>
<li><p>对比Flask框架，Django原生提供了众多的功能组件，让开发更简便快速</p>
</li>
<li><ul>
<li>提供项目工程管理的自动化脚本工具</li>
<li>数据库ORM支持（对象关系映射，英语：Object Relational Mapping）</li>
<li>模板</li>
<li>表单</li>
<li>Admin管理站点</li>
<li>文件管理</li>
<li>认证权限</li>
<li>session机制</li>
<li>缓存</li>
</ul>
</li>
</ul>
<p><strong>（2）MVT模式</strong></p>
<ul>
<li><p>MVC程序设计模式（Model-View-Controller）：其核心思想是分工、解耦，让不同的代码块之间降低耦合，增强代码的可扩展性和可移植性，实现向后兼容</p>
</li>
<li><p>最早由TrygveReenskaug在1978年提出，是施乐帕罗奥多研究中心(Xerox PARC)在20世纪80年代为程序语言Smalltalk发明的一种软件设计模式，是为了将传统的输入（input）、处理（processing）、输出（output）任务运用到图形化用户交互模型中而设计的。随着标准输入输出设备的出现，开发人员只需要将精力集中在业务逻辑的分析与实现上</p>
</li>
<li><p>后来被推荐为Oracle旗下Sun公司Java EE平台的设计模式，并且受到越来越多的使用ColdFusion和PHP的开发者的欢迎。现在虽然不再使用原来的分工方式，但是这种分工的思想被沿用下来，广泛应用于软件工程中，是一种典型并且应用广泛的软件架构模式。后来，MVC的思想被应用在了Ｗeb开发方面，被称为Ｗeb MVC框架</p>
</li>
<li><p><strong>MVC模式</strong></p>
</li>
<li><ul>
<li>M全拼为Model，主要封装对数据库层的访问，对数据库中的数据进行增、删、改、查操作。</li>
<li>V全拼为View，用于封装结果，生成页面展示的html内容。</li>
<li>C全拼为Controller，用于接收请求，处理业务逻辑，与Model和View交互，返回结果。</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1664963461630-3b5524f6-c6cd-4e85-bd3d-2c51ba1f2840.png" alt="img"></p>
<ul>
<li><p><strong>MVT模式（Django）</strong></p>
</li>
<li><ul>
<li>M全拼为Model，与MVC中的M功能相同，负责和数据库交互，进行数据处理。</li>
<li>V全拼为View，与MVC中的C功能相同，接收请求，进行业务处理，返回应答。</li>
<li>T全拼为Template，与MVC中的V功能相同，负责封装构造要返回的html。</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1664963492971-8a59b7fe-cc82-4ba1-a8f2-745d1f817258.png" alt="img"></p>
<h1 id="三、Django流程"><a href="#三、Django流程" class="headerlink" title="三、Django流程"></a>三、Django流程</h1><ul>
<li>MVT流程</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1664959507190-fcea960f-b0d0-45cc-aa67-097c3c9001f6.png" alt="img"></p>
<h2 id="1-创建工程"><a href="#1-创建工程" class="headerlink" title="1. 创建工程"></a>1. 创建工程</h2><ul>
<li><p>在使用Flask框架时，项目工程目录的组织与创建是需要我们自己手动创建完成的</p>
</li>
<li><p>在django中，项目工程目录可以借助django提供的命令帮助我们创建</p>
</li>
<li><p>创建工程：<code>django-admin startproject 工程名称</code></p>
</li>
</ul>
<p>执行后，会多出一个工程名称的新目录，此即为新创建的工程目录</p>
<ul>
<li><p>查看创建的工程目录，结构如下</p>
</li>
<li><ul>
<li>与项目同名的目录</li>
<li>settings.py：项目的整体配置文件</li>
<li>urls.py：项目的URL配置文件</li>
<li>wsgi.py：项目与WSGI兼容的Web服务器入口</li>
<li>manage.py：项目管理文件，通过它管理项目</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1664984680705-71b5c43d-80c3-4e68-8f44-a62644ef9062.png" alt="img"></p>
<ul>
<li><p>运行开发服务器（在开发阶段，为了能够快速预览到开发的效果，django提供了一个纯python编写的轻量级web服务器，仅在开发阶段使用），运行服务器命令：<code>python manage.py runserver ip:端口</code></p>
</li>
<li><ul>
<li>设置其他IP访问：将IP加入工程文件settings.py中的ALLOWED_HOSTS列表：<code>ALLOWED_HOSTS = []</code>，运行命令：<code>python manage.py runserver 0:端口</code></li>
</ul>
</li>
</ul>
<p>可以不写IP和端口，默认IP是127.0.0.1，默认端口为8000</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1664984694065-119a4edf-74be-4e3c-b64c-be22205545b3.png" alt="img"></p>
<ul>
<li>在浏览器中输入网址便可看到效果：127.0.0.1:8000</li>
</ul>
<p>django默认工作在调式Debug模式下，如果增加、修改、删除文件，服务器会自动重启</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1664984731998-d53d5294-23bd-4baf-a161-b13dc91a0b81.png" alt="img"></p>
<ul>
<li>停止服务器：<code>ctrl+c</code></li>
</ul>
<h2 id="2-创建子应用"><a href="#2-创建子应用" class="headerlink" title="2. 创建子应用"></a>2. 创建子应用</h2><ul>
<li>在Web应用中，通常有一些业务功能模块是在不同的项目中都可以复用的，故在开发中通常将工程项目拆分为不同的子功能模块，各功能模块间可以保持相对的独立，在其他工程项目中需要用到某个特定功能模块时，可以将该模块代码整体复制过去，达到复用，在Flask框架中也有类似子功能应用模块的概念，即蓝图（Blueprint）</li>
<li>Django的视图编写是放在子应用中的</li>
<li>创建子应用模块目录：<code>python manage.py startapp 子应用名称</code></li>
</ul>
<p>manage.py为上述创建工程时自动生成的管理文件</p>
<ul>
<li><p>执行后，可以看到工程目录中多出了一个子目录，结构如下</p>
</li>
<li><ul>
<li>admin.py：与网站的后台管理站点配置相关</li>
<li>apps.py：用于配置当前子应用的相关信息</li>
<li>migrations：用于存放数据库迁移历史文件</li>
<li>models.py：用户保存数据库模型类</li>
<li>tests.py：用于开发测试用例，编写单元测试</li>
<li>views.py：用于编写Web应用视图</li>
</ul>
</li>
<li><p>子应用需要注册安装后才能使用，注册安装子应用：将子应用的配置信息文件添加到工程配置文件settings.py中的INSTALLED_APPS列表中</p>
</li>
</ul>
<p>此步骤需要设置PyCharm的解释器：可以通过which python查看虚拟环境的python脚本路径</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665060170230-4cd937bc-7e4e-405c-af36-d827854dcc51.png" alt="img"></p>
<h2 id="3-模块"><a href="#3-模块" class="headerlink" title="3. 模块"></a>3. 模块</h2><ul>
<li><p>模块：MVT设计模式中的M（model）</p>
</li>
<li><p>使用Django进行数据库开发的提示 ：</p>
</li>
<li><ul>
<li>MVT设计模式中的Model，专门负责和数据库交互，对应models.py</li>
<li>由于Model中内嵌了ORM框架，所以不需要直接面向数据库编程，而是定义模型类, 通过模型类和对象完成数据库表的增删改查</li>
<li>ORM框架就是把数据库表的行与相应的对象建立关联，互相转换，使得数据库的操作面向对象</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665029664990-253fc052-ce13-42d6-a41e-ebe9063f475c.png" alt="img"></p>
<ul>
<li><p>使用Django进行数据库开发的步骤 ：</p>
</li>
<li><ul>
<li><strong>定义模型类</strong></li>
</ul>
</li>
<li><ul>
<li><ul>
<li>优化模型类展示，可以使用__str__魔法函数</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfo</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">10</span>)</span><br><span class="line">    <span class="comment"># 添加Manage实例的属性对象，以便视图调用</span></span><br><span class="line">    objects = models.Manager()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PeopleInfo</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">10</span>)</span><br><span class="line">    age = models.BooleanField()</span><br><span class="line">    book = models.ForeignKey(BookInfo,on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>

<p><strong>遇到的问题</strong></p>
<p>关联外键时遇到错误：TypeError: <strong>init</strong>() missing 1 required positional argument: ‘on_delete’</p>
<p><strong>解决方案</strong></p>
<p>给关联的模型添加限制：<code>models.ForeignKey(User, on_delete=models.CASCADE)</code></p>
<ul>
<li><ul>
<li><strong>模型迁移</strong></li>
</ul>
</li>
</ul>
<ol>
<li><ol>
<li><ol>
<li>生成迁移文件（根据模型类生成创建表）：<code>python manage.py makemigrations</code></li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1664980076622-b01c443a-e6c1-4f8c-b8d7-97e99e723661.png" alt="img"></p>
<ol>
<li><ol>
<li><ol>
<li>执行迁移（根据第一步生成的语句在数据库中创建表）：<code>python manage.py migrate</code></li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1664980187114-50c693fc-fa27-44b8-9caf-5bbac26c666f.png" alt="img"></p>
<ul>
<li><ul>
<li><strong>操作数据库</strong>（默认采用sqlite3数据库来存储数据）</li>
</ul>
</li>
<li><p>需要pycharm专业版才能看数据库视图（database工具）</p>
</li>
<li><p>pycharm社区版可以安装插件：DB Browser，但只能连接数据库，无法打开数据库文件</p>
</li>
</ul>
<h2 id="4-站点管理"><a href="#4-站点管理" class="headerlink" title="4. 站点管理"></a>4. 站点管理</h2><ul>
<li><p>站点：分为内容发布（模块）和公共访问（视图）两部分</p>
</li>
<li><ul>
<li>内容发布：由网站的管理员负责查看、添加、修改、删除数据</li>
</ul>
</li>
<li><p>Django能够根据定义的模型类自动地生成管理模块：</p>
</li>
</ul>
<ol>
<li><ol>
<li>管理界面本地化：本地化是将显示的语言、时间等使用本地的习惯</li>
</ol>
</li>
</ol>
<ul>
<li><ul>
<li><ul>
<li>中国大陆地区使用简体中文：<code>LANGUAGE_CODE = &#39;zh-Hans&#39;</code></li>
<li>时区使用亚洲&#x2F;上海时区：<code>TIME_ZONE = &#39;Asia/Shanghai&#39;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li><ol>
<li>创建管理员：<code>python manage.py createsuperuser</code>，按提示输入用户名、邮箱、密码</li>
</ol>
</li>
</ol>
<ul>
<li><ul>
<li><ul>
<li>重置密码：<code>python manager.py changepassword 用户名</code></li>
<li>登陆站点：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li><ol>
<li>在应用的admin.py文件中注册模型类：<code>admin.site.register(模型类)</code>，注册后可以在站点管理界面方便快速的管理数据</li>
</ol>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665041922679-14cd9cab-ef03-4522-9035-ea11e68f6ce8.png" alt="img"></p>
<h2 id="5-视图"><a href="#5-视图" class="headerlink" title="5. 视图"></a>5. 视图</h2><ul>
<li><p>视图：MVT设计模式中的V（View），对于Django的设计框架MVT，用户在URL中请求的是视图，视图接收请求后进行处理，并将处理的结果返回给请求者</p>
</li>
<li><p>使用视图时需要进行两步操作</p>
</li>
<li><ul>
<li><strong>定义视图</strong></li>
</ul>
</li>
<li><ul>
<li><ul>
<li>视图就是一个Python函数，被定义在应用的views.py中</li>
<li>视图的第一个参数是HttpRequest类型的对象：reqeust，包含了所有请求信息</li>
<li>视图必须返回HttpResponse对象，包含返回给请求者的响应信息</li>
<li>需要导入HttpResponse模块：<code>from django.http import HttpResponse</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;index&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li><strong>配置URLconf</strong></li>
</ul>
</li>
<li><ul>
<li><ul>
<li>查找视图的过程 :</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li><ol>
<li><ol>
<li><ol>
<li>请求者在浏览器地址栏中输入URL, 请求到网站</li>
<li>网站获取URL信息</li>
<li>然后与编写好的URLconf逐条匹配</li>
<li>如果匹配成功则调用对应的视图</li>
<li>如果所有的URLconf都没有匹配成功，则返回404错误</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<ul>
<li><ul>
<li><ul>
<li>URLconf入口：工程中的settings.py文件，<code>ROOT_URLCONF = &#39;bookmanager.urls&#39;</code></li>
<li>需要两步完成URLconf配置</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li><ol>
<li><ol>
<li><ol>
<li>在项目中定义URLconf</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include,path</span><br><span class="line"><span class="comment"># 固定写法，值为列表</span></span><br><span class="line"><span class="comment"># http://ip:port get和post请求不参与匹配</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;index/&#x27;</span>,include(<span class="string">&#x27;index.urls&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ol>
<li><ol>
<li><ol>
<li><ol>
<li>在应用中定义URLconf</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> index <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一条URLconf包括URL规则、视图两部分</span></span><br><span class="line"><span class="comment"># URL规则：使用正则表达式定义</span></span><br><span class="line"><span class="comment"># 视图：在views.py中定义的视图函数</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>,views.index),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>视图处理过程</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665042141756-d67b7974-6c85-49cb-9028-e27ea48699fd.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665042184138-579c561c-6174-4862-ab11-461b91bd0df6.png" alt="img"></p>
<ul>
<li>url匹配过程</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665043323775-6a9832a8-72ca-4728-8a5a-1f5a00b9fbe1.png" alt="img"></p>
<h2 id="6-模版"><a href="#6-模版" class="headerlink" title="6. 模版"></a>6. 模版</h2><ul>
<li>模板：MVT设计模式中的T（Template），在Django中，将前端的内容定义在模板中, 然后再把模板交给视图调用</li>
<li>模板使用步骤</li>
</ul>
<ol>
<li><ol>
<li>创建模板</li>
</ol>
</li>
</ol>
<ul>
<li><ul>
<li><ul>
<li>在应用同级目录下创建模板文件夹（固定写法）：<code>templates</code></li>
<li>在templates文件夹下，创建应用同名文件夹</li>
<li>在应用同名文件夹下创建网页模板文件</li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li><ol>
<li>设置模板查找路径</li>
</ol>
</li>
</ol>
<ul>
<li><ul>
<li><ul>
<li>找到工程下的settings.py文件</li>
<li>在TEMPLATES变量里设置：<code>&#39;DIRS&#39;: [BASE_DIR / &#39;templates&#39;]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<ol>
<li><ol>
<li>模板接收视图传入的数据</li>
</ol>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    context = &#123;<span class="string">&#x27;title&#x27;</span>:<span class="string">&#x27;测试数据&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;index/index.html&#x27;</span>,context)</span><br></pre></td></tr></table></figure>

<ol>
<li><ol>
<li>模板处理数据</li>
</ol>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>视图-模版流程</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665052745815-9569b323-360e-4095-a9ec-cc895fc728ed.png" alt="img"></p>
<h2 id="7-配置文件和静态文件"><a href="#7-配置文件和静态文件" class="headerlink" title="7. 配置文件和静态文件"></a>7. 配置文件和静态文件</h2><p><strong>（1）配置文件</strong></p>
<ul>
<li>BASE_DIR：当前工程的根目录，Django会依此来定位工程内的相关文件，我们也可以使用该参数来构造文件路径</li>
</ul>
<p>BASE_DIR &#x3D; Path(<strong>file</strong>).resolve().parent.parent：表示当前文件相对路径的父级的父级</p>
<ul>
<li><p>DEBUG：调试模式，创建工程后初始值为True，即默认工作在调试模式下</p>
</li>
<li><ul>
<li>修改代码文件后，程序会自动重启</li>
<li>程序出现异常时，会向前端显示详细的错误追踪信息（非调试模式下，仅返回Server Error (500)）</li>
</ul>
</li>
</ul>
<p>注意：部署线上运行的Django不要运行在调式模式下，需要修改：<code>DEBUG=False</code>和<code>ALLOW_HOSTS</code></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665054854411-47664609-d326-44e9-9a2c-bb326850f0a2.png" alt="img"></p>
<ul>
<li>本地语言与时区：Django支持本地化处理，本地化是将显示的语言、时间等使用本地的习惯，初始化的工程默认英语和UTC标准时区</li>
</ul>
<p><strong>（2）静态文件</strong></p>
<ul>
<li><p>项目中的CSS、图片、js都是静态文件，一般会将静态文件放到一个单独的目录中，以方便管理</p>
</li>
<li><p>在html页面中调用时，也需要指定静态文件的路径，Django中提供了一种解析的方式配置静态文件路径，静态文件可以放在项目根目录下，也可以放在应用的目录下</p>
</li>
<li><p>由于有些静态文件在项目中是通用的，所以推荐放在项目的根目录下，步骤如下</p>
</li>
<li><ul>
<li>在根目录下创建静态文件目录，一般命名为：static</li>
<li>需要在工程下的settings.py配置两个参数</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>STATIC_URL：访问静态文件的URL前缀</li>
<li>STATICFILES_DIRS：存放查找静态文件的目录</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = <span class="string">&#x27;static/&#x27;</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR,<span class="string">&#x27;static&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p><strong>（3）App应用配置</strong></p>
<ul>
<li>在每个应用目录中都包含了apps.py文件，用于保存该应用的相关信息</li>
<li>在创建应用时，Django会向apps.py文件中写入一个该应用的配置类</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665054583335-78262685-4a04-4916-ab86-e0296560da65.png" alt="img"></p>
<ul>
<li>将此类添加到工程settings.py中的INSTALLED_APPS列表中，表明注册安装具备此配置属性的应用</li>
<li>AppConfig.name：表示该配置类是加载的应用，每个配置类必须包含此属性，默认自动生成</li>
<li>AppConfig.verbose_name：用于设置该应用的直观可读的名字，此名字在Django提供的Admin管理站点中会显示</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">IndexConfig</span>(<span class="title class_ inherited__">AppConfig</span>):</span><br><span class="line">    default_auto_field = <span class="string">&#x27;django.db.models.BigAutoField&#x27;</span></span><br><span class="line">    name = <span class="string">&#x27;index&#x27;</span></span><br><span class="line">    verbose_name = <span class="string">&#x27;后台相关&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665060699769-21dd7559-1193-41c9-84e1-f74272d08070.png" alt="img"></p>
<h1 id="四、模型"><a href="#四、模型" class="headerlink" title="四、模型"></a>四、模型</h1><h2 id="1-项目准备"><a href="#1-项目准备" class="headerlink" title="1. 项目准备"></a>1. 项目准备</h2><ul>
<li><p>进入指定虚拟环境：<code>workon 虚拟环境名称</code></p>
</li>
<li><p>进入指定根目录，创建项目：<code>django-admin startproject 项目名</code></p>
</li>
<li><p>进入工程文件，创建应用：<code>python manage.py startapp 应用名</code></p>
</li>
<li><p>进入代码编辑环境，打开项目，更换python解释器</p>
</li>
<li><p>安装添加子应用：<code>应用名.apps.配置类名</code></p>
</li>
<li><p>本地化</p>
</li>
<li><ul>
<li>设置中文：<code>LANGUAGE_CODE = &#39;zh-Hans&#39;</code></li>
<li>设置时区：<code>TIME_ZONE = &#39;Asia/Shanghai&#39;</code></li>
</ul>
</li>
<li><p>准备模板</p>
</li>
<li><ul>
<li>在根目录下创建<code>templates</code>模板文件夹</li>
<li>设置模版路径：<code>&#39;DIRS&#39;: [BASE_DIR / &#39;templates&#39;]</code></li>
</ul>
</li>
<li><p>配置项目urls路径：只要不是admin&#x2F;就算匹配成功，并包含到应用中的urls.py</p>
</li>
<li><p>创建应用urls.py并配置路径：路径中包含booklist&#x2F;，就调用视图中对应的函数</p>
</li>
<li><p>定义视图：提供数据库信息</p>
</li>
<li><p>进入项目文件，开启项目对应的服务器：<code>python manage.py runserver</code></p>
</li>
<li><p>浏览器中输入网址：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://127.0.0.1:8000/booklist/">http://127.0.0.1:8000/booklist/</a></p>
</li>
</ul>
<h2 id="2-配置"><a href="#2-配置" class="headerlink" title="2. 配置"></a>2. 配置</h2><ul>
<li>工程目录settings.py中保存了数据库的连接配置信息，Django默认初始配置使用sqlite数据库</li>
</ul>
<p>sqlite是嵌入式的关系型数据库，主要在移动端使用，属于小型的关系型数据库</p>
<ul>
<li>使用MySQL数据库首先需要安装驱动程序：<code>pip install PyMySQL</code></li>
<li>在工程目录__init__.py文件中添加如下代码，让Django的ORM能以mysqldb的方式来调用PyMySQL</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<ul>
<li>回到工程目录&#x2F;settings.py中修改DATABASES配置信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;192.168.241.128&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>:<span class="number">3306</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>:<span class="string">&#x27;book&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在MySQL中创建数据库：<code>create database charset=utf8;</code></p>
<h2 id="3-定义模型类"><a href="#3-定义模型类" class="headerlink" title="3. 定义模型类"></a>3. 定义模型类</h2><ul>
<li>模型类被定义在应用的models.py文件中</li>
<li>模型类必须继承自Model类，位于包django.db.models中</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfo</span>(models.Model):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>数据库表名</strong></p>
</li>
<li><ul>
<li>通过db_table指明数据库表名：<code>db_table = 表名</code></li>
<li>默认表名：<code>小写app应用名_小写模型类名</code></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfo</span>(models.Model):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        <span class="comment"># 修改表名</span></span><br><span class="line">        db_table = <span class="string">&#x27;bookinfo&#x27;</span></span><br><span class="line">        <span class="comment"># 在admin站点中显示的名称</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;图书&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>主键</strong></p>
</li>
<li><ul>
<li>django会为表创建自动增长的主键列，每个模型只能有一个主键列</li>
<li>默认创建的主键列属性为id，可以使用pk代替（primary key）</li>
<li>如果使用选项设置某属性为主键列，django不会再创建自动增长的主键列</li>
</ul>
</li>
<li><p><strong>属性命名</strong></p>
</li>
<li><ul>
<li>不能是python、sql的保留关键字</li>
<li>不允许使用连续的下划线，这是由django的查询方式决定的</li>
<li>定义属性时需要指定字段类型，通过字段类型的参数指定选项</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>语法：<code>属性=models.字段类型(选项)</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>字段类型</strong></p>
</li>
<li><ul>
<li><code>AutoField</code>：自动增长的IntegerField，通常不用指定（Django会自动创建属性名为id的自动增长属性）</li>
<li><code>BooleanField</code>：布尔字段，值为True或False</li>
<li><code>NullBooleanField</code>：支持Null、True、False三种值</li>
<li><code>CharField</code>：字符串</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>max_length：表示最大字符个数（必须设置）</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><code>TextField</code>：大文本字段，一般超过4000个字符时使用</li>
<li><code>IntegerField</code>：整数</li>
<li><code>DecimalField</code>：十进制浮点数</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>max_digits：表示总位数</li>
<li>decimal_places：表示小数位数</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><code>FloatField</code>：浮点数</li>
<li><code>DateField</code>：日期</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>auto_now：表示每次保存对象时，自动设置该字段为当前时间，用于”最后一次修改”的时间戳，它总是使用当前日期，默认为False </li>
<li>auto_now_add：表示当对象第一次被创建时自动设置当前时间，用于创建的时间戳，它总是使用当前日期，默认为False</li>
<li>auto_now_add和auto_now是相互排斥的，组合将会发生错误</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><code>TimeField</code>：时间，参数同DateField</li>
<li><code>DateTimeField</code>：日期时间，参数同DateField</li>
<li><code>FileField</code>：上传文件字段</li>
<li><code>ImageField</code>：继承于FileField，对上传的内容进行校验，确保是有效的图片</li>
</ul>
</li>
<li><p><strong>选项</strong></p>
</li>
<li><ul>
<li><code>null</code>：数据库范畴如果为True，表示允许为空，默认值是False</li>
<li><code>blank</code>：表单验证范畴如果为True，则该字段允许为空白，默认值是False</li>
<li><code>db_column</code>：字段的名称，如果未指定，则使用属性的名称</li>
<li><code>db_index</code>：若值为True, 则在表中会为此字段创建索引，默认值是False</li>
<li><code>default</code>：默认</li>
<li><code>primary_key</code>：若为True，则该字段会成为模型的主键字段，默认值是False，一般作为AutoField的选项使用</li>
<li><code>unique</code>：如果为True, 这个字段在表中必须有唯一值，默认值是False</li>
<li><code>on_delete</code>：设置外键</li>
<li><code>choices</code>：有序字典</li>
</ul>
</li>
<li><p><strong>外键</strong></p>
</li>
<li><ul>
<li>在设置外键时，需要通过on_delete选项指明主表删除数据时，对于外键引用表数据如何处理，在django.db.models中包含了可选常量：</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><code>CASCADE</code>：级联，删除主表数据时连通一起删除外键表中数据</li>
<li><code>PROTECT</code>：保护，通过抛出ProtectedError异常，来阻止删除主表中被外键应用的数据</li>
<li><code>SET_NULL</code>：设置为NULL，仅在该字段null&#x3D;True允许为null时可用</li>
<li><code>SET_DEFAULT</code>：设置为默认值，仅在该字段设置了默认值时可用</li>
<li><code>SET()</code>：设置为特定值或者调用特定方法</li>
<li><code>DO_NOTHING</code>：不做任何操作，如果数据库前置指明级联性，此选项会抛出IntegrityError异常</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>使用外键关联的表，django映射到数据库时，会自动在关联表添加一个字段</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>字段名称：<code>关联字段名称_被关联表主键字段名称</code></li>
<li>如果外键是在中途添加的，则在运行中会报错，需要自己手动添加关联字段</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="comment"># 准备书籍列表信息的模型类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfo</span>(models.Model):</span><br><span class="line">    <span class="comment"># 创建字段，字段类型...</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;名称&#x27;</span>)</span><br><span class="line">    pub_date = models.DateField(verbose_name=<span class="string">&#x27;发布日期&#x27;</span>,null=<span class="literal">True</span>)</span><br><span class="line">    readcount = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;阅读量&#x27;</span>)</span><br><span class="line">    commentcount = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;评论量&#x27;</span>)</span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>, verbose_name=<span class="string">&#x27;逻辑删除&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;bookinfo&#x27;</span>  <span class="comment"># 指明数据库表名</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;图书&#x27;</span>  <span class="comment"># 在admin站点中显示的名称</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;定义每个数据对象的显示信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备人物列表信息的模型类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PeopleInfo</span>(models.Model):</span><br><span class="line">    GENDER_CHOICES = (</span><br><span class="line">        (<span class="number">0</span>, <span class="string">&#x27;male&#x27;</span>),</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&#x27;female&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>, verbose_name=<span class="string">&#x27;名称&#x27;</span>)</span><br><span class="line">    gender = models.SmallIntegerField(choices=GENDER_CHOICES, default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;性别&#x27;</span>)</span><br><span class="line">    description = models.CharField(max_length=<span class="number">200</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&#x27;描述信息&#x27;</span>)</span><br><span class="line">    book_id = models.ForeignKey(BookInfo, on_delete=models.CASCADE, verbose_name=<span class="string">&#x27;图书&#x27;</span>)  <span class="comment"># 外键</span></span><br><span class="line">    is_delete = models.BooleanField(default=<span class="literal">False</span>, verbose_name=<span class="string">&#x27;逻辑删除&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        db_table = <span class="string">&#x27;peopleinfo&#x27;</span></span><br><span class="line">        verbose_name = <span class="string">&#x27;人物信息&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>

<h2 id="4-模型迁移"><a href="#4-模型迁移" class="headerlink" title="4. 模型迁移"></a>4. 模型迁移</h2><ul>
<li>生成迁移文件：<code>python manage.py makemigrations</code></li>
<li>同步到数据库中：<code>python manage.py migrate</code></li>
</ul>
<p><strong>问题描述</strong>：执行python manage.py makemigrations 时，提示：No changes detected</p>
<p><strong>解决方案</strong>：<code>执行python manage.py makemigrations 应用名称</code></p>
<p>测试数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> bookinfo(name, pub_date, readcount,commentcount, is_delete) <span class="keyword">values</span></span><br><span class="line">(<span class="string">&#x27;射雕英雄传&#x27;</span>, <span class="string">&#x27;1980-5-1&#x27;</span>, <span class="number">12</span>, <span class="number">34</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="string">&#x27;天龙八部&#x27;</span>, <span class="string">&#x27;1986-7-24&#x27;</span>, <span class="number">36</span>, <span class="number">40</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="string">&#x27;笑傲江湖&#x27;</span>, <span class="string">&#x27;1995-12-24&#x27;</span>, <span class="number">20</span>, <span class="number">80</span>, <span class="number">0</span>),</span><br><span class="line">(<span class="string">&#x27;雪山飞狐&#x27;</span>, <span class="string">&#x27;1987-11-11&#x27;</span>, <span class="number">58</span>, <span class="number">24</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> peopleinfo(name, gender, book_id_id, description, is_delete)  <span class="keyword">values</span></span><br><span class="line">  (<span class="string">&#x27;郭靖&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;降龙十八掌&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;黄蓉&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;打狗棍法&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;黄药师&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;弹指神通&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;欧阳锋&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;蛤蟆功&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;梅超风&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;九阴白骨爪&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;乔峰&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;降龙十八掌&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;段誉&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;六脉神剑&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;虚竹&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;天山六阳掌&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;王语嫣&#x27;</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="string">&#x27;神仙姐姐&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;令狐冲&#x27;</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">&#x27;独孤九剑&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;任盈盈&#x27;</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="string">&#x27;弹琴&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;岳不群&#x27;</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="string">&#x27;华山剑法&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;东方不败&#x27;</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="string">&#x27;葵花宝典&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;胡斐&#x27;</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="string">&#x27;胡家刀法&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;苗若兰&#x27;</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="string">&#x27;黄衣&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;程灵素&#x27;</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="string">&#x27;医术&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">  (<span class="string">&#x27;袁紫衣&#x27;</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="string">&#x27;六合拳&#x27;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h2 id="5-shell工具和mysql日志"><a href="#5-shell工具和mysql日志" class="headerlink" title="5. shell工具和mysql日志"></a>5. shell工具和mysql日志</h2><ul>
<li><p><strong>shell工具</strong>：Django的manage工具提供了shell命令，帮助我们配置好当前工程的运行环境（如连接好数据库等），以便可以直接在终端中执行测试python语句</p>
</li>
<li><ul>
<li>进入shell：<code>python manage.py shell</code></li>
</ul>
</li>
<li><p><strong>查看MySQL数据库日志</strong>：查看mysql数据库日志可以查看对数据库的操作记录，mysql日志文件默认没有产生</p>
</li>
<li><ul>
<li>打开文件，取消以下两行注释：<code>sudo vi /etc/mysql/mysql.conf.d/mysqld.cnf</code></li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665160480915-6be41cd4-bf18-472a-a648-54491931aa9a.png" alt="img"></p>
<ul>
<li><ul>
<li>重启mysql服务：<code>sudo service mysql restart</code></li>
<li>打开mysql日志文件：<code>sudo tail -f /var/log/mysql/query.log</code>，可以实时查看数据库的日志内容</li>
</ul>
</li>
</ul>
<h2 id="6-数据库操作"><a href="#6-数据库操作" class="headerlink" title="6. 数据库操作"></a>6. 数据库操作</h2><ul>
<li><p><strong>增加数据两种方法</strong></p>
</li>
<li><ul>
<li><strong>save</strong>：创建模型类对象，执行对象的<code>save()</code>方法</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; from book.models import BookInfo,PeopleInfo</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book = BookInfo(</span></span><br><span class="line">...         name=&#x27;python入门&#x27;,</span><br><span class="line">...         pub_date=&#x27;2010-1-1&#x27;</span><br><span class="line">...     )</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book.save()</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book</span></span><br><span class="line">&lt;BookInfo: python入门&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li><strong>create</strong>：通过<code>模型类.objects.create()</code>保存</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; BookInfo.objects.create(</span></span><br><span class="line">...     name=&#x27;java&#x27;,</span><br><span class="line">...     pub_date=&#x27;2021-1-1&#x27;</span><br><span class="line">... )</span><br><span class="line">&lt;BookInfo: java&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>修改更新两种方法</strong></p>
</li>
<li><ul>
<li><strong>save</strong>：查找模型类对象，修改模型类对象的属性，然后执行<code>save()</code>方法</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book=BookInfo.objects.get(<span class="built_in">id</span>=2)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book.readcount = 20</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book.save()</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book</span></span><br><span class="line">&lt;BookInfo: 射雕英雄传&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li><strong>update</strong>：使用<code>模型类.objects.filter().update()</code>更新，会返回受影响的行数</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; BookInfo.objects.filter(<span class="built_in">id</span>=2).update(readcount=100,commentcount=200)</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>删除两种方法</strong></p>
</li>
<li><ul>
<li><strong>delete</strong>：查找模型类对象，然后执行<code>delete()</code>方法</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book=BookInfo.objects.get(<span class="built_in">id</span>=4)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book.delete()</span></span><br><span class="line">(5, &#123;&#x27;book.PeopleInfo&#x27;: 4, &#x27;book.BookInfo&#x27;: 1&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li><strong>delete</strong>：使用<code>模型类.objects.filter().delete()</code>删除，会返回受影响的行数</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; BookInfo.objects.filter(<span class="built_in">id</span>=1).delete()</span></span><br><span class="line">(6, &#123;&#x27;book.PeopleInfo&#x27;: 5, &#x27;book.BookInfo&#x27;: 1&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="7-数据库查询"><a href="#7-数据库查询" class="headerlink" title="7. 数据库查询"></a>7. 数据库查询</h2><h3 id="（1）基础条件查询"><a href="#（1）基础条件查询" class="headerlink" title="（1）基础条件查询"></a>（1）基础条件查询</h3><ul>
<li><p><strong>基本查询</strong></p>
</li>
<li><ul>
<li><code>模型类.objects.get()</code>：查询单一结果，返回单一对象</li>
<li><code>模型类.objects.all()</code>：查询多个结果，返回列表</li>
<li><code>模型类.objects.count()</code>：查询结果数量</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">等价于BookInfo.objects.get(id__exact=6)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; PeopleInfo.objects.get(<span class="built_in">id</span>=6)</span></span><br><span class="line">&lt;PeopleInfo: 乔峰&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; PeopleInfo.objects.all()</span></span><br><span class="line">&lt;QuerySet [&lt;PeopleInfo: 乔峰&gt;, &lt;PeopleInfo: 段誉&gt;, &lt;PeopleInfo: 虚竹&gt;, &lt;PeopleInfo: 王语嫣&gt;, &lt;PeopleInfo: 令狐冲&gt;, &lt;PeopleInfo: 任盈盈&gt;, &lt;PeopleInfo: 岳不群&gt;, &lt;PeopleInfo: 东方不败&gt;]&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; PeopleInfo.objects.count()</span></span><br><span class="line">8</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>过滤查询</strong>：实现SQL中的where功能，表达语法：<code>模型类.objects.过滤器(字段名__过滤条件=值)</code></p>
</li>
<li><ul>
<li><code>filter</code>：过滤出多个结果，返回列表（包含n个结果）</li>
<li><code>exclude</code>：排除掉符合条件剩下的结果</li>
<li><code>get</code>：过滤单一结果，返回1个结果</li>
</ul>
</li>
<li><p><strong>过滤条件</strong></p>
</li>
<li><ul>
<li>相等查询</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><code>exact</code>：相等查询，区分大小写</li>
<li><code>iexact</code>：相等查询，不区分大小写</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>模糊查询</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><code>contains</code>：是否包含（如果包含%无需转义），区分大小写</li>
<li><code>icontains</code>：是否包含（如果包含%无需转义），不区分大小写</li>
<li><code>startswith</code>：以指定值开头，区分大小写</li>
<li><code>istartswith</code>：以指定值开头，不区分大小写</li>
<li><code>endswith</code>：以指定值结尾，区分大小写</li>
<li><code>iendswith</code>：以指定值结尾，不区分大小写</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>空查询</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><code>isnull</code>：是否为null</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>范围查询</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><code>in</code>：是否包含在范围内</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>比较查询</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><code>gt</code>：大于（greater then）</li>
<li><code>gte</code>：大于等于（greater then equal）</li>
<li><code>lt</code>：小于（less then）</li>
<li><code>lte</code>：小于等于（less then equal）</li>
<li>不等于的运算符，使用<code>exclude()</code>过滤器</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>日期查询</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><code>year</code></li>
<li><code>month</code></li>
<li><code>day</code></li>
<li><code>week_day</code></li>
<li><code>hour</code></li>
<li><code>minute</code></li>
<li><code>second</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询书名包含<span class="string">&#x27;湖&#x27;</span>的图书</span></span><br><span class="line">BookInfo.objects.filter(name__contains=&#x27;湖&#x27;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询书名以<span class="string">&#x27;部&#x27;</span>结尾的图书</span></span><br><span class="line">BookInfo.objects.filter(name__endswith=&#x27;部&#x27;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询书名为空的图书</span></span><br><span class="line">BookInfo.objects.filter(name__isnull=False)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询编号为1或3或5的图书</span></span><br><span class="line">BookInfo.objects.filter(id__in=[1,3,5])</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询编号大于3的图书</span></span><br><span class="line">BookInfo.objects.filter(id__gt=3)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询书籍<span class="built_in">id</span>不为3的图书</span></span><br><span class="line">BookInfo.objects.exclude(id__exact=3)</span><br><span class="line">BookInfo.objects.exclude(id=3)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询1980年发表的图书</span></span><br><span class="line">BookInfo.objects.filter(pub_date__year=&#x27;1986&#x27;)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询1990年1月1日后发表的图书</span></span><br><span class="line">BookInfo.objects.filter(pub_date__gt=&#x27;1990-1-1&#x27;)</span><br></pre></td></tr></table></figure>

<h3 id="（2）F和Q对象"><a href="#（2）F和Q对象" class="headerlink" title="（2）F和Q对象"></a>（2）F和Q对象</h3><ul>
<li>F对象：可做算数运算</li>
<li>引入语法：<code>from django.db.models import F</code></li>
<li>F对象语法：<code>F(属性名)</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询阅读量大于等于评论量的图书。</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; BookInfo.objects.filter(readcount__gt=F(<span class="string">&#x27;commentcount&#x27;</span>))</span></span><br><span class="line">&lt;QuerySet [&lt;BookInfo: 雪山飞狐&gt;]&gt;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>Q对象：可以使用<code>&amp;</code>、<code>|</code>、<code>~</code>连接，<code>&amp;</code>表示逻辑与，<code>|</code>表示逻辑或，<code>~</code>表示逻辑非</p>
</li>
<li><p>引入语法：<code>from django.db.models import Q</code></p>
</li>
<li><p>Q对象语法：<code>Q(属性名__运算符=值)</code></p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询阅读量大于20，或编号小于3的图书，只能使用Q对象实现</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; BookInfo.objects.filter(Q(readcount__gt=20)|Q(id__lt=3))</span></span><br><span class="line">&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 雪山飞狐&gt;]&gt;</span><br><span class="line">Q对象前可以使用~操作符，表示非not。</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询编号不等于3的图书</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; BookInfo.objects.filter(~Q(<span class="built_in">id</span>=3))</span></span><br><span class="line">&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 雪山飞狐&gt;]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="（3）聚合函数和排序函数"><a href="#（3）聚合函数和排序函数" class="headerlink" title="（3）聚合函数和排序函数"></a>（3）聚合函数和排序函数</h3><ul>
<li><p><strong>聚合函数</strong>：使用<code>aggregate()</code>过滤器调用聚合函数，返回值是一个字典类型</p>
</li>
<li><ul>
<li>返回字典格式：<code>&#123;&#39;属性名__聚合类小写&#39;:值&#125;</code></li>
<li>聚合函数包括</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>Avg：平均</li>
<li>Count：数量</li>
<li>Max：最大</li>
<li>Min：最小</li>
<li>Sum：求和</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>导入语法：<code>from django.db.models import Avg,Count,Max,Min,Sum</code></li>
<li>使用语法：<code>模型类.objects.aggregate(聚合函数(字段名))</code></li>
</ul>
</li>
</ul>
<p>使用count时一般不使用aggregate()过滤器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询图书的总阅读量</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; BookInfo.objects.aggregate(Sum(<span class="string">&#x27;readcount&#x27;</span>))</span></span><br><span class="line">&#123;&#x27;readcount__sum&#x27;: 126&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><strong>排序</strong>：使用<code>order_by()</code>对结果进行排序（默认升序），语法：<code>查询结果集.order_by()</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">升序</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; BookInfo.objects.all().order_by(<span class="string">&#x27;readcount&#x27;</span>)</span></span><br><span class="line">&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 笑傲江湖&gt;, &lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 雪山飞狐&gt;]&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">降序</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; BookInfo.objects.all().order_by(<span class="string">&#x27;-readcount&#x27;</span>)</span></span><br><span class="line">&lt;QuerySet [&lt;BookInfo: 雪山飞狐&gt;, &lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 笑傲江湖&gt;, &lt;BookInfo: 射雕英雄传&gt;]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="（4）关联查询"><a href="#（4）关联查询" class="headerlink" title="（4）关联查询"></a>（4）关联查询</h3><ul>
<li><p><strong>关联查询</strong></p>
</li>
<li><ul>
<li>一对多的访问语法：<code>一对应的模型类对象.多对应的模型类名小写_set</code></li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book = BookInfo.objects.get(<span class="built_in">id</span>=1)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book.peopleinfo_set.all()</span></span><br><span class="line">&lt;QuerySet [&lt;PeopleInfo: 郭靖&gt;, &lt;PeopleInfo: 黄蓉&gt;, &lt;PeopleInfo: 黄药师&gt;, &lt;PeopleInfo: 欧阳锋&gt;, &lt;PeopleInfo: 梅超风&gt;]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>多对一的访问语法：<code>多对应的模型类对象.多对应的模型类中的关系类属性名(外键)</code></li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">person = PeopleInfo.objects.get(id=1)</span><br><span class="line">person.book_id.name</span><br><span class="line">&lt;BookInfo: 射雕英雄传&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>一对多中对应一的id访问语法：<code>多对应的模型类对象.关联类属性_id</code></li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; person = PeopleInfo.objects.get(<span class="built_in">id</span>=1)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; person.book_id_id</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>



<ul>
<li><p><strong>关联过滤查询</strong></p>
</li>
<li><ul>
<li>多对一的访问语法：<code>关联模型类名小写__属性名__条件运算符=值</code>，如果没有”<code>__条件运算符</code>“部分，表示等于</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询图书，要求图书人物为<span class="string">&quot;郭靖&quot;</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book = BookInfo.objects.filter(peopleinfo__name=<span class="string">&#x27;郭靖&#x27;</span>)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book</span></span><br><span class="line">&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;]&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询图书，要求图书中人物的描述包含<span class="string">&quot;八&quot;</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book = BookInfo.objects.filter(peopleinfo__description__contains=<span class="string">&#x27;八&#x27;</span>)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; book</span></span><br><span class="line">&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 天龙八部&gt;]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>一对多的访问语法：<code>一模型类关联属性名__一模型类属性名__条件运算符=值</code>，如果没有”<code>__条件运算符</code>“部分，表示等于</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询书名为“天龙八部”的所有人物</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; people = PeopleInfo.objects.filter(book__name=<span class="string">&#x27;天龙八部&#x27;</span>)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; people</span></span><br><span class="line">&lt;QuerySet [&lt;PeopleInfo: 乔峰&gt;, &lt;PeopleInfo: 段誉&gt;, &lt;PeopleInfo: 虚竹&gt;, &lt;PeopleInfo: 王语嫣&gt;]&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询图书阅读量大于30的所有人物</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; people = PeopleInfo.objects.filter(book__readcount__gt=30)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; people</span></span><br><span class="line">&lt;QuerySet [&lt;PeopleInfo: 乔峰&gt;, &lt;PeopleInfo: 段誉&gt;, &lt;PeopleInfo: 虚竹&gt;, &lt;PeopleInfo: 王语嫣&gt;, &lt;PeopleInfo: 胡斐&gt;, &lt;PeopleInfo: 苗若兰&gt;, &lt;PeopleInfo: 程灵素&gt;, &lt;PeopleInfo: 袁紫衣&gt;]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="（5）查询集QuerySet"><a href="#（5）查询集QuerySet" class="headerlink" title="（5）查询集QuerySet"></a>（5）查询集QuerySet</h3><ul>
<li><p>查询集：也称查询结果集、QuerySet，表示从数据库中获取的对象集合</p>
</li>
<li><p>当调用如下过滤器方法时，Django会返回查询集（而不是简单的列表）：</p>
</li>
<li><ul>
<li>all()：返回所有数据</li>
<li>filter()：返回满足条件的数据</li>
<li>exclude()：返回满足条件之外的数据</li>
<li>order_by()：对结果进行排序</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; books = BookInfo.objects.filter(readcount__gt=30).order_by(<span class="string">&#x27;pub_date&#x27;</span>)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; books</span></span><br><span class="line">&lt;QuerySet [&lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 雪山飞狐&gt;]&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>对查询集可以再次调用过滤器进行过滤，也就意味着查询集可以含有零个、一个或多个过滤器，过滤器基于所给的参数限制查询的结果</p>
</li>
<li><p>判断某一个查询集中是否有数据：<code>查询集.exists()</code>，如果有则返回True，没有则返回False</p>
</li>
<li><p><strong>查询集两大特性</strong></p>
</li>
<li><ul>
<li>惰性执行：创建查询集不会访问数据库，直到调用数据时，才会访问数据库，调用数据的情况包括迭代、序列化、与if合用。继续执行遍历迭代操作后，才真正的进行了数据库的查询</li>
<li>缓存：使用同一个查询集，第一次使用时会发生数据库的查询，经过存储后，Django会把结果缓存下来，再次使用这个查询集时会使用缓存的数据，减少了数据库的查询次数</li>
</ul>
</li>
<li><p><strong>限制查询集</strong>：等同于sql中的limit和offset子句（不支持负数索引）</p>
</li>
<li><ul>
<li>对查询切片：<code>查询集.[索引]</code>，使用索引进行切片，会返回一个新的查询集，不会立即执行查询</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>如果获取一个对象，使用[0]等同于[0:1].get()</li>
<li>如果没有数据，[0]会引发IndexError异常，[0:1].get()会引发DoesNotExist异常</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>对查询集分页：<code>Paginator(查询集,每页数据条数)</code></li>
</ul>
</li>
<li><ul>
<li><ul>
<li>获取指定页码数据：<code>paginator.page(页数)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询数据</span></span><br><span class="line">books = BookInfo.objects.all()</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">导入分页类</span></span><br><span class="line">from django.core.paginator import Paginator</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建分页实例，每页2条</span></span><br><span class="line">paginator=Paginator(books,2)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">获取指定页码的数据</span></span><br><span class="line">page_skus = paginator.page(1)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">获取分页数据</span></span><br><span class="line">total_page=paginator.num_pages</span><br></pre></td></tr></table></figure>

<h1 id="五、视图"><a href="#五、视图" class="headerlink" title="五、视图"></a>五、视图</h1><ul>
<li><p>视图就是应用中views.py文件中的函数</p>
</li>
<li><p>视图负责接受Web请求HttpRequest，进行逻辑处理，返回Web响应HttpResponse给请求者</p>
</li>
<li><ul>
<li>响应内容可以是HTML内容，404错误，重定向，json数据等</li>
</ul>
</li>
<li><p>视图的第一个参数必须为HttpRequest对象，还可能包含参数</p>
</li>
<li><ul>
<li>通过正则表达式组获取的位置参数</li>
<li>通过正则表达式组获得的关键字参数</li>
</ul>
</li>
<li><p>视图必须返回一个HttpResponse对象或子对象作为响应</p>
</li>
<li><ul>
<li>子对象：JsonResponse</li>
<li>子对象：HttpResponseRedirect</li>
</ul>
</li>
<li><p>使用视图时需要进行两步操作，两步操作不分先后</p>
</li>
<li><ul>
<li>配置URLconf</li>
<li>在应用&#x2F;views.py中定义视图</li>
</ul>
</li>
<li><p>视图处理过程</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665236485404-d8d55175-ccf0-4e49-9a74-6a097435c248.png" alt="img"></p>
<h2 id="1-URLconf"><a href="#1-URLconf" class="headerlink" title="1. URLconf"></a>1. URLconf</h2><ul>
<li>浏览者通过在浏览器的地址栏中输入网址请求网站，对于Django开发的网站，由哪一个视图进行处理请求，是由url匹配找到的</li>
<li>请求的url被看做是一个普通的python字符串，进行匹配时不包括域名、get或post参数</li>
<li>配置URLconf</li>
</ul>
<ol>
<li><ol>
<li>settings.py中指定url配置：<code>ROOT_URLCONF = &#39;项目.urls&#39;</code></li>
<li>项目中urls.py匹配成功后，包含到应用的urls.py：<code>path(正则, include(&#39;应用.urls&#39;))</code></li>
<li>应用中urls.py匹配成功后，调用views.py对应的函数：<code>path(正则, views.函数名)</code></li>
</ol>
</li>
</ol>
<ul>
<li><p>关于正则</p>
</li>
<li><ul>
<li>正则部分推荐使用 r，表示字符串不转义</li>
<li>不能在开始加<code>/</code>，推荐在结束加<code>/</code>（虽然结尾带<code>/</code>能带来上述好处，但是却违背了HTTP中URL表示资源位置路径的设计理念，是否结尾带<code>/</code>以所属公司定义风格为准）</li>
</ul>
</li>
</ul>
<h2 id="2-路由命名与reverse反解析"><a href="#2-路由命名与reverse反解析" class="headerlink" title="2. 路由命名与reverse反解析"></a>2. 路由命名与reverse反解析</h2><p>（1）路由命名：在定义路由的时候，可以为路由命名，方便查找特定视图的具体路径信息</p>
<ul>
<li><p>在使用include函数定义路由时，可以使用namespace参数定义路由的命名空间</p>
</li>
<li><ul>
<li>语法：<code>path(正则,include((&#39;应用.urls&#39;,应用名),namespace=应用名))</code></li>
<li>命名空间表示：凡是<code>应用.urls</code>中定义的路由，均属于namespace指明的应用名下</li>
<li>命名空间的作用：避免不同应用中的路由使用了相同的名字发生冲突，使用命名空间区别开</li>
</ul>
</li>
<li><p>在定义普通路由时，可以使用name参数指明路由的名字，语法：<code>path(正则,对应视图,name=路由名)</code></p>
</li>
</ul>
<p>（2）reverse反解析：使用reverse函数，可以根据路由名称，返回具体的路径</p>
<ul>
<li><p>导入reverse：<code>from django.urls import reverse</code></p>
</li>
<li><p>语法</p>
</li>
<li><ul>
<li>对于指明命名空间的：<code>url = reverse(命名空间namespace:路由名name)</code></li>
<li>对于未指明命名空间的：<code>url = reverse(路由名name)</code></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, include((<span class="string">&#x27;book.urls&#x27;</span>,<span class="string">&#x27;book&#x27;</span>),namespace=<span class="string">&#x27;book&#x27;</span>)),</span><br><span class="line">]</span><br><span class="line"><span class="comment"># book/urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;booklist/&#x27;</span>, booklist,name=<span class="string">&#x27;booklist&#x27;</span>),</span><br><span class="line">]</span><br><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">booklist</span>(<span class="params">request</span>):</span><br><span class="line">    url = reverse(<span class="string">&#x27;book:booklist&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;index&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="3-HttpRequest对象"><a href="#3-HttpRequest对象" class="headerlink" title="3. HttpRequest对象"></a>3. HttpRequest对象</h2><ul>
<li><p>利用HTTP协议向服务器传参的几种途径</p>
</li>
<li><ul>
<li>提取URL的特定部分，可以在服务器端的路由中用正则表达式截取</li>
<li>查询字符串（query string)</li>
<li>请求体（body）中发送的数据，比如表单数据、json、xml</li>
<li>在http报文的头中（header）</li>
</ul>
</li>
</ul>
<h3 id="（1）URL路径参数"><a href="#（1）URL路径参数" class="headerlink" title="（1）URL路径参数"></a>（1）URL路径参数</h3><ul>
<li><p>从URL中获取值，需要在正则表达式中使用分组，获取值分为两种方式</p>
</li>
<li><ul>
<li>位置参数：参数的位置不能错</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># book/urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;^(\d+)/(\d+)/$&#x27;</span>, index),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py: 参数的位置不能错</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request, value1, value2</span>):</span><br><span class="line">    <span class="comment"># 构造上下文</span></span><br><span class="line">    context = &#123;<span class="string">&#x27;v1&#x27;</span>:value1, <span class="string">&#x27;v2&#x27;</span>:value2&#125;</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;index&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>关键字参数：参数的位置可以变，跟关键字保持一致即可</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># book/urls.py</span></span><br><span class="line"><span class="comment"># 其中?P&lt;value1&gt;部分表示为这个参数定义的名称为value1</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    re_path(<span class="string">r&#x27;^(?P&lt;value1&gt;\d+)/(?P&lt;value2&gt;\d+)/$&#x27;</span>, index),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># views.py: 参数的位置可以变，跟关键字保持一致即可</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request, value1, value2</span>):</span><br><span class="line">    <span class="comment"># 构造上下文</span></span><br><span class="line">    context = &#123;<span class="string">&#x27;v1&#x27;</span>:value1, <span class="string">&#x27;v2&#x27;</span>:value2&#125;</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;index&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>注意：两种参数的方式不要混合使用，在一个正则表达式中只能使用一种参数方式</p>
<h3 id="（2）Django中的QueryDict对象"><a href="#（2）Django中的QueryDict对象" class="headerlink" title="（2）Django中的QueryDict对象"></a>（2）Django中的QueryDict对象</h3><ul>
<li><p>HttpRequest对象的属性GET、POST都是QueryDict类型的对象，查询字符串不区分请求方式，即假使客户端进行POST方式的请求，依然可以通过request.GET获取请求中的查询字符串数据</p>
</li>
<li><p>与python字典不同，QueryDict类型的对象可以用来处理同一个键带有多个值的情况</p>
</li>
<li><p>获取请求路径中的查询字符串参数（形如?k1&#x3D;v1&amp;k2&#x3D;v2）：<code>request.GET</code>，返回QueryDict对象</p>
</li>
<li><p>方法get()</p>
</li>
<li><ul>
<li>语法：<code>get(&#39;键&#39;,默认值)</code></li>
<li>如果一个键同时拥有多个值，将获取最后一个值</li>
<li>如果键不存在则返回None值，可以设置默认值进行后续处理</li>
</ul>
</li>
<li><p>方法getlist()</p>
</li>
<li><ul>
<li>语法：<code>getlist(&#39;键&#39;,默认值)</code></li>
<li>可以获取指定键的所有值，值以列表返回</li>
<li>如果键不存在则返回空列表[]，可以设置默认值进行后续处理</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发送请求 127.0.0.1:8000/1/100?a=1&amp;b=2&amp;a=3</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    a = request.GET</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="built_in">print</span>(a.get(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(a.getlist(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;QueryDict: &#123;&#x27;a&#x27;: [&#x27;1&#x27;, &#x27;3&#x27;], &#x27;b&#x27;: [&#x27;2&#x27;]&#125;&gt;</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># [&#x27;1&#x27;, &#x27;3&#x27;]</span></span><br></pre></td></tr></table></figure>

<h3 id="（3）请求体"><a href="#（3）请求体" class="headerlink" title="（3）请求体"></a>（3）请求体</h3><ul>
<li><p>请求体数据格式不固定，可以是表单类型字符串&#x2F;JSON字符串&#x2F;XML字符串，应区别对待</p>
</li>
<li><p>请求体数据的请求方式有POST、PUT、PATCH、DELETE</p>
</li>
<li><p>Django默认开启了CSRF防护，会对上述请求方式进行CSRF防护验证，在测试时可以关闭CSRF防护机制</p>
</li>
<li><ul>
<li>方法：在settings.py文件中注释掉CSRF中间件</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665507258192-fba4146e-e34b-4a5a-b525-55d25328fb3a.png" alt="img"></p>
<ul>
<li><p><strong>表单类型 Form Data</strong>：前端发送的表单类型的请求体数据</p>
</li>
<li><ul>
<li>获取请求体数据：<code>request.POST</code>，返回QueryDict对象</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    a = request.POST.get(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    b = request.POST.get(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">    alist = request.POST.getlist(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="built_in">print</span>(b)</span><br><span class="line">    <span class="built_in">print</span>(alist)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># [&#x27;1&#x27;, &#x27;3&#x27;]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>非表单类型 Non-Form Data</strong>：非表单类型的请求体数据，Django无法自动解析</p>
</li>
<li><ul>
<li>获取请求体数据：<code>request.body</code>，返回bytes类型</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 得到json形式的字符串</span></span><br><span class="line">    a = request.body</span><br><span class="line">    a_str = a.decode()</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="built_in">print</span>(a_str)</span><br><span class="line">    <span class="comment"># json形式的字符串转换为字典：json.loads()</span></span><br><span class="line">    <span class="comment"># 字典转换为json形式的字符串 json.dumps()</span></span><br><span class="line">    data = json.loads(a_str)</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># b&#x27;&#123;\n    &quot;username&quot;:&quot;itcast&quot;,\n    &quot;password&quot;:&quot;123&quot;\n&#125;&#x27;</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#     &quot;username&quot;:&quot;itcast&quot;,</span></span><br><span class="line"><span class="comment">#     &quot;password&quot;:&quot;123&quot;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line"><span class="comment"># &#123;&#x27;username&#x27;: &#x27;itcast&#x27;, &#x27;password&#x27;: &#x27;123&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="（4）请求头"><a href="#（4）请求头" class="headerlink" title="（4）请求头"></a>（4）请求头</h3><ul>
<li><p>获取请求头headers中的数据：<code>request.META</code>，返回字典类型</p>
</li>
<li><p>常见的请求头</p>
</li>
<li><ul>
<li>CONTENT_LENGTH– The length of the request body (as a string)</li>
<li>CONTENT_TYPE– The MIME type of the request body</li>
<li>HTTP_ACCEPT– Acceptable content types for the response</li>
<li>HTTP_ACCEPT_ENCODING– Acceptable encodings for the response</li>
<li>HTTP_ACCEPT_LANGUAGE– Acceptable languages for the response</li>
<li>HTTP_HOST– The HTTP Host header sent by the client</li>
<li>HTTP_REFERER– The referring page, if any</li>
<li>HTTP_USER_AGENT– The client’s user-agent string</li>
<li>QUERY_STRING– The query string, as a single (unparsed) string</li>
<li>REMOTE_ADDR– The IP address of the client</li>
<li>REMOTE_HOST– The hostname of the client</li>
<li>REMOTE_USER– The user authenticated by the Web server, if any</li>
<li>REQUEST_METHOD– A string such as”GET”or”POST”</li>
<li>SERVER_NAME– The hostname of the server</li>
<li>SERVER_PORT– The port of the server (as a string)</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    a = request.META</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="built_in">print</span>(a[<span class="string">&#x27;PATH&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(a)</span><br></pre></td></tr></table></figure>

<h3 id="（5）其他常用HttpRequest对象属性"><a href="#（5）其他常用HttpRequest对象属性" class="headerlink" title="（5）其他常用HttpRequest对象属性"></a>（5）其他常用HttpRequest对象属性</h3><ul>
<li><p>method：一个字符串，表示请求使用的HTTP方法，常用值包括：’GET’、’POST’</p>
</li>
<li><p>user：请求的用户对象</p>
</li>
<li><p>path：一个字符串，表示请求页面的完整路径，不包含域名和参数部分</p>
</li>
<li><p>encoding：一个字符串，表示提交的数据的编码方式</p>
</li>
<li><ul>
<li>如果为None则表示使用浏览器的默认设置，一般为utf-8</li>
<li>属性是可写的，可以通过修改它来修改访问表单数据使用的编码，接下来对属性的任何访问将使用新的encoding值</li>
</ul>
</li>
<li><p>FILES：一个类似于字典的对象，包含所有的上传文件</p>
</li>
</ul>
<h2 id="4-HttpResponse对象"><a href="#4-HttpResponse对象" class="headerlink" title="4. HttpResponse对象"></a>4. HttpResponse对象</h2><ul>
<li>视图在接收请求并处理后，必须返回HttpResponse对象或子对象</li>
<li>HttpRequest对象由Django创建，HttpResponse对象由开发人员创建</li>
</ul>
<h3 id="（1）HttpResponse"><a href="#（1）HttpResponse" class="headerlink" title="（1）HttpResponse"></a>（1）HttpResponse</h3><ul>
<li>构造响应对象：<code>HttpResponse(content=响应体, content_type=响应体数据类型, status=状态码)</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># content_type：MIME类型，语法形式：大类/小类（例：text/html）</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(content=<span class="string">&#x27;index&#x27;</span>,content_type=<span class="string">&#x27;text/html&#x27;</span>,status=<span class="number">200</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>通过HttpResponse对象属性来设置响应体、响应体数据类型、状态码</p>
</li>
<li><ul>
<li>content：表示返回的内容，传递字符串，不要传递对象</li>
<li>status_code：返回的HTTP响应状态码，范围：100-599</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    response = HttpResponse(<span class="string">&#x27;itcast python&#x27;</span>)</span><br><span class="line">    response.status_code = <span class="number">400</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<ul>
<li>设置响应头（字典形式）：<code>HttpResponse[响应头名称] = 响应头值</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    response = HttpResponse(<span class="string">&#x27;itcast python&#x27;</span>, status=<span class="number">400</span>)</span><br><span class="line">    <span class="comment"># 自定义响应头Itcast, 值为Python</span></span><br><span class="line">    response[<span class="string">&#x27;itcast&#x27;</span>] = <span class="string">&#x27;Python&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h3 id="（2）HttpResponse子类"><a href="#（2）HttpResponse子类" class="headerlink" title="（2）HttpResponse子类"></a>（2）HttpResponse子类</h3><ul>
<li><p>Django提供了一系列HttpResponse的子类，可以快速设置状态码</p>
</li>
<li><ul>
<li>HttpResponseRedirect：301</li>
<li>HttpResponsePermanentRedirect：302</li>
<li>HttpResponseNotModified：304</li>
<li>HttpResponseBadRequest：400</li>
<li>HttpResponseNotFound：404</li>
<li>HttpResponseForbidden：403</li>
<li>HttpResponseNotAllowed：405</li>
<li>HttpResponseGone：410</li>
<li>HttpResponseServerError：500</li>
</ul>
</li>
</ul>
<h3 id="（3）JsonResponse"><a href="#（3）JsonResponse" class="headerlink" title="（3）JsonResponse"></a>（3）JsonResponse</h3><ul>
<li>若要返回json数据，可以使用JsonResponse来构造响应对象，将json数据转换为json字符串</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="comment"># 设置响应头Content-Type为application/json</span></span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;beijing&#x27;</span>, <span class="string">&#x27;subject&#x27;</span>: <span class="string">&#x27;python&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="（4）redirect重定向"><a href="#（4）redirect重定向" class="headerlink" title="（4）redirect重定向"></a>（4）redirect重定向</h3><ul>
<li>跳转指定页面</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> redirect</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/booklist&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="5-状态保持"><a href="#5-状态保持" class="headerlink" title="5. 状态保持"></a>5. 状态保持</h2><ul>
<li><p>浏览器请求服务器是无状态的</p>
</li>
<li><ul>
<li>无状态：每次请求都是一次新的请求</li>
<li>无状态原因：浏览器与服务器是使用Socket套接字进行通信的，服务器将请求结果返回给浏览器之后，会关闭当前的Socket连接，而且服务器也会在处理页面完毕之后销毁页面对象</li>
</ul>
</li>
<li><p>实现状态保持主要有两种方式</p>
</li>
<li><ul>
<li>在客户端存储信息使用Cookie</li>
<li>在服务器端存储信息使用Session</li>
</ul>
</li>
</ul>
<h3 id="（1）Cookie"><a href="#（1）Cookie" class="headerlink" title="（1）Cookie"></a>（1）Cookie</h3><ul>
<li>Cookie：有时也用其复数形式Cookies，指某些网站为了辨别用户身份、进行session跟踪而储存在用户本地终端上的数据（通常经过加密）</li>
<li>Cookie由服务器端生成，发送给User-Agent（一般是浏览器），浏览器会将Cookie的key&#x2F;value保存到某个目录下的文本文件内，下次请求同一网站时就发送该Cookie给服务器（前提是浏览器设置为启用cookie）</li>
<li>Cookie名称和值可以由服务器端开发自己定义，这样服务器可以知道该用户是否是合法用户以及是否需要重新登录等</li>
<li>服务器可以利用Cookies包含信息的任意性来筛选并经常性维护这些信息，以判断在HTTP传输中的状态</li>
<li>Cookie是存储在浏览器中的一段纯文本信息，建议不要存储敏感信息如密码，因为电脑上的浏览器可能被其它人使用</li>
<li><strong>Cookie原理</strong></li>
</ul>
<ol>
<li><ol>
<li>第一次请求过程</li>
</ol>
</li>
<li><ol>
<li><ol>
<li>浏览器第一次请求服务器，请求头中不会携带任何cookie信息</li>
<li>服务器接收到请求之后，会为响应设置cookie信息（set_cookie）</li>
<li>浏览器接收到响应后，会将cookie信息保存起来</li>
</ol>
</li>
</ol>
</li>
<li><ol>
<li>第二次及其之后的过程</li>
</ol>
</li>
<li><ol>
<li><ol>
<li>浏览器第二次及其之后的请求，请求头中都会携带cookie信息</li>
<li>服务器接收到请求之后，不用再为响应设置cookie信息</li>
</ol>
</li>
</ol>
</li>
</ol>
<ul>
<li><p><strong>Cookie的特点</strong></p>
</li>
<li><ul>
<li>Cookie以键值对的格式进行信息的存储，保存在客户端</li>
<li>Cookie基于域名，不同域名的Cookie是不能互相访问的（当浏览器请求某网站时，会将浏览器存储的跟网站相关的所有Cookie信息提交给网站服务器）</li>
</ul>
</li>
<li><p><strong>设置Cookie</strong>：<code>HttpResponse.set_cookie(cookie名, value=cookie值, max_age=cookie有效期)</code></p>
</li>
<li><ul>
<li>max_age单位为秒，默认为None（如果是临时cookie，可将设置为None）</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cookie</span>(<span class="params">request</span>):</span><br><span class="line">    response = HttpResponse(<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">    response.set_cookie(<span class="string">&#x27;itcast1&#x27;</span>, <span class="string">&#x27;python1&#x27;</span>)  <span class="comment"># 临时cookie</span></span><br><span class="line">    response.set_cookie(<span class="string">&#x27;itcast2&#x27;</span>, <span class="string">&#x27;python2&#x27;</span>, max_age=<span class="number">3600</span>)  <span class="comment"># 有效期一小时</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>读取Cookie</strong>：<code>request.COOKIES.get(cookie名)</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cookie</span>(<span class="params">request</span>):</span><br><span class="line">    cookie1 = request.COOKIES.get(<span class="string">&#x27;itcast1&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(cookie1)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;OK&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>删除Cookie</strong>：<code>HttpResponse.delete_cookie(cookie名)</code>，或设置max_age为0</li>
</ul>
<h3 id="（2）Session"><a href="#（2）Session" class="headerlink" title="（2）Session"></a>（2）Session</h3><ul>
<li><strong>Session原理</strong></li>
</ul>
<ol>
<li><ol>
<li>第一次请求过程</li>
</ol>
</li>
<li><ol>
<li><ol>
<li>浏览器第一次请求服务器，可以携带一些信息，请求头中没有携带任何cookie信息</li>
<li>服务器接收到请求之后，会为响应设置session</li>
</ol>
</li>
</ol>
</li>
<li><ol>
<li><ol>
<li><ol>
<li>将session信息保存在服务器中（包含sessionid及请求携带的信息）</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665841536545-778f0efe-b592-4369-bc52-0c279e31de4a.png" alt="img"></p>
<ol>
<li><ol>
<li><ol>
<li><ol>
<li>为响应设置cookie信息，key为sessionid</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665841356244-64356e1b-f793-49ee-b2a6-0e37920cb610.png" alt="img"></p>
<ol>
<li><ol>
<li>第二次及其之后的过程</li>
</ol>
</li>
<li><ol>
<li><ol>
<li>浏览器第二次及其之后的请求，请求头中都会携带cookie信息（sessionid）</li>
<li>服务器接收到请求后，会获取session id并进行验证，验证成功后即可获取session信息</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665841425407-6c5b837e-63aa-4114-a9bb-c8339d9cb59a.png" alt="img"></p>
<ul>
<li><p><strong>Session特点</strong></p>
</li>
<li><ul>
<li>保存在服务器</li>
<li>依赖于Cookie（若浏览器禁用了Cookie，则无法实现Session）</li>
</ul>
</li>
<li><p><strong>设置Session</strong>：<code>request.session[键] = 值</code></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_session</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="built_in">print</span>(request.COOKIES)</span><br><span class="line">    user_ID = <span class="number">123</span></span><br><span class="line">    request.session[<span class="string">&#x27;user_name&#x27;</span>] = user_ID</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;set_session&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>获取Session</strong>：</p>
</li>
<li><ul>
<li>方式一：<code>request.session[键]</code></li>
<li>方式二：<code>request.session.get(键,默认值)</code></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_session</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="built_in">print</span>(request.COOKIES)</span><br><span class="line">    <span class="comment"># 方式一</span></span><br><span class="line">    user_id = request.session[<span class="string">&#x27;user_name&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(user_id)</span><br><span class="line">    <span class="comment"># 方式二</span></span><br><span class="line">    user_id = request.session.get(<span class="string">&#x27;user_name&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(user_id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;get_session&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;&#x27;sessionid&#x27;: &#x27;l1somhrpn6ylo0t43hwk7h6ems78vi5a&#x27;&#125;</span></span><br><span class="line"><span class="comment"># 123</span></span><br><span class="line"><span class="comment"># 123</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>Session其他操作</strong></p>
</li>
<li><ul>
<li>清除所有session，在存储中删除值部分：<code>request.session.clear()</code></li>
<li>清除所有session数据，在存储中删除键和值：<code>request.session.flush()</code></li>
<li>删除session中的指定键及值，在存储中只删除某个键及对应的值：<code>del request.session[&#39;键&#39;]</code></li>
<li>设置session的有效期：<code>request.session.set_expiry(value)</code></li>
</ul>
</li>
<li><ul>
<li><ul>
<li>如果value为整数，session将在value秒没有活动后过期</li>
<li>如果value为0，那么用户session的Cookie将在用户的浏览器关闭时过期</li>
<li>如果value为None，那么session有效期将采用系统默认值， 默认为两周，可以通过在settings.py中设置SESSION_COOKIE_AGE来设置全局默认值</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>启用Session</strong>：Django项目默认启用Session，可以在settings.py文件中查看，如需禁用session，将图中的session中间件注释掉即可</p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665679364525-499efb96-338f-4ade-bc80-dfc0c44fbd83.png" alt="img"></p>
<ul>
<li><p><strong>Session存储方式</strong>：在settings.py文件中，可以设置session数据的存储方式，保存在数据库、本地缓存等</p>
</li>
<li><ul>
<li>数据库（可以不设置，是默认存储方式）</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>设置方式：<code>SESSION_ENGINE=&#39;django.contrib.sessions.backends.db&#39;</code></li>
<li>如果存储在数据库中，需要在项INSTALLED_APPS中安装Session应用</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665679596888-77aa5d8b-a2d8-4468-93ce-90fb9a6be860.png" alt="img"></p>
<ul>
<li><ul>
<li><ul>
<li>数据库中的表：django_session</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>操作Session包括三个数据：键，值，过期时间</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665679805599-caadb755-2f6d-44cb-8b73-30356bbdd658.png" alt="img"></p>
<ul>
<li><ul>
<li>本地缓存：存储在本机内存中，如果丢失则不能找回，比数据库的方式读写更快</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>设置方式：<code>SESSION_ENGINE=&#39;django.contrib.sessions.backends.cache&#39;</code></li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>混合存储：优先从本机内存中存取，如果没有则从数据库中存取</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>设置方式：<code>SESSION_ENGINE=&#39;django.contrib.sessions.backends.cached_db&#39;</code></li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>Redis：在redis中保存session，需要引入第三方扩展，可以使用django-redis来解决</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>安装扩展：<code>pip install django-redis</code></li>
<li>配置：在settings.py文件中做如下设置</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">&quot;default&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;BACKEND&quot;</span>: <span class="string">&quot;django_redis.cache.RedisCache&quot;</span>,</span><br><span class="line">        <span class="comment"># 注意：若redis服务器IP不是本地回环地址，需要修改为实际ip</span></span><br><span class="line">        <span class="string">&quot;LOCATION&quot;</span>: <span class="string">&quot;redis://127.0.0.1:6379/1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;OPTIONS&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;CLIENT_CLASS&quot;</span>: <span class="string">&quot;django_redis.client.DefaultClient&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br><span class="line">SESSION_CACHE_ALIAS = <span class="string">&#x27;default&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SetSession</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        request.session[<span class="string">&#x27;name&#x27;</span>]=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">        <span class="keyword">return</span>  HttpResponse(<span class="string">&#x27;set session&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GetSeesion</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        name = request.session.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(name)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;get session&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1666524635885-aea6fe94-3d77-41c2-9da8-93314d2a5c03.png" alt="img"></p>
<h2 id="6-类视图与中间件"><a href="#6-类视图与中间件" class="headerlink" title="6. 类视图与中间件"></a>6. 类视图与中间件</h2><h3 id="（1）类视图"><a href="#（1）类视图" class="headerlink" title="（1）类视图"></a>（1）类视图</h3><ul>
<li>函数视图：以函数的方式定义的视图称为函数视图，函数视图便于理解；但若一个视图对应的路径中，提供了多种不同HTTP的请求方式时，则需要在一个函数中编写不同的业务逻辑，代码可读性与复用性都不佳</li>
</ul>
<p>例：在一个注册视图中处理get和post请求<br><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665584194414-cb085e2c-fc3b-47d4-a319-177c7c7a3a48.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;处理注册&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取请求方法，判断是GET/POST请求</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="comment"># 处理GET请求，返回注册页面</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;这里实现注册页面&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 处理POST请求，实现注册逻辑</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;这里实现注册逻辑&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>类视图</strong>：使用类视图可以根据视图中的不同请求方式实现类中的不同方法，定义类视图需要继承自Django提供的父类View</p>
</li>
<li><ul>
<li>优点：代码可读性高，相对于函数视图有更高的复用性</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;类视图：处理注册&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;处理GET请求，返回注册页面&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;这里实现注册页面&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;处理POST请求，实现注册逻辑&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;这里实现注册逻辑&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>类视图路由配置</strong>：使用类视图的<code>as_view()</code>方法来添加</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 类视图：注册</span></span><br><span class="line">    path(<span class="string">&#x27;1/100/&#x27;</span>,RegisterView.as_view())</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>类视图原理</strong></p>
</li>
<li><ul>
<li>类RegisterView继承自View类</li>
</ul>
</li>
<li><ul>
<li><code>RegisterView.as_view()</code>：即使用View类中的类方法</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>初始化：<code>as_view()</code>方法返回<code>view</code>方法</li>
<li>收到请求后便会调用<code>view()</code>，返回时调用<code>dispatch()</code>方法</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665844740784-6353bfb9-e2f1-4924-8454-c875b0a1b7e9.png" alt="img"></p>
<ul>
<li><ul>
<li><code>dispatch()</code>方法中会判断请求方式是否在<code>http_method_names</code>列表中</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>若存在，则转化前端请求方式全部为小写，并返回执行对应方法（类RegisterView中）</li>
<li>若不存在，则返回错误状态码（默认405）</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665845568042-97a688e5-da7b-4625-87e7-7a4b2b17606e.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665844800966-c59a2be0-8168-42d8-8f94-a8114b866756.png" alt="img"></p>
<ul>
<li><strong>类视图的多继承重写</strong>：使用面向对象多继承的特性（遵循MRO的继承顺序）</li>
</ul>
<p>例：判断是否为登录状态，若登录则显示，若未登录则不显示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.mixins <span class="keyword">import</span> LoginRequiredMixin</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CenterView</span>(LoginRequiredMixin,View):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;OK&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>若未登录，则跳转页面</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665847274585-2766b4ac-8af2-43b7-aee0-63a1b4872e55.png" alt="img"></p>
<h3 id="（2）中间件"><a href="#（2）中间件" class="headerlink" title="（2）中间件"></a>（2）中间件</h3><ul>
<li><p>Django中的中间件是一个轻量级、底层的插件系统，可以介入Django的请求和响应处理过程，修改Django的输入或输出</p>
</li>
<li><p>中间件的设计为开发者提供了一种无侵入式的开发方式，增强了Django框架的健壮性</p>
</li>
<li><p><strong>定义中间件</strong>：</p>
</li>
<li><ul>
<li>定义一个中间件工厂函数，然后返回一个可以被调用的中间件</li>
<li>中间件工厂函数需要接收一个可以调用的get_response对象</li>
<li>返回的中间件也是一个可以被调用的对象，并且像视图一样需要接收一个request对象参数，返回一个response对象</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">simple_middleware</span>(<span class="params">get_response</span>):</span><br><span class="line">    <span class="comment"># 此处编写的代码仅在Django第一次配置和初始化的时候执行一次</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">middleware</span>(<span class="params">request</span>):</span><br><span class="line">        <span class="comment"># 此处编写的代码会在每个请求处理视图前被调用</span></span><br><span class="line">        response = get_response(request)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> middleware</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665847882797-ae06eca5-52f9-44d8-8323-a488eed23580.png" alt="img"></p>
<ul>
<li><strong>注册中间件</strong>：定义好中间件后，需要在settings.py文件中添加注册中间件</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665847841090-37629d7a-2205-4225-819c-1585860752db.png" alt="img"></p>
<ul>
<li><strong>中间件初始化（</strong>Django运行在调试模式下，中间件初始化部分内容有可能被调用两次）</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665848449656-5ad6ae16-f4e3-498c-a2ce-d6baccefe38f.png" alt="img"></p>
<ul>
<li><strong>定义视图并调用</strong></li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665848590782-66b54a50-adef-449d-97cf-2d03664ac6bf.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665848557527-38602e37-7055-48e5-b8fc-8f09acc49a40.png" alt="img"></p>
<ul>
<li><p><strong>多个中间件的执行顺序（类似递归）</strong></p>
</li>
<li><ul>
<li>在请求视图被处理前，中间件由上至下依次执行</li>
<li>在请求视图被处理后，中间件由下至上依次执行</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665848842261-cc0091eb-1717-4a76-9023-5d7924bc9055.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665848952753-b70311f6-66fc-4b5a-b3a2-90d2d5b37f10.png" alt="img"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665848854229-b39f8b9e-d7aa-4aec-a895-45fb2cb4554e.png" alt="img"></p>
<h1 id="六、模版"><a href="#六、模版" class="headerlink" title="六、模版"></a>六、模版</h1><h2 id="1-自带模版"><a href="#1-自带模版" class="headerlink" title="1. 自带模版"></a>1. 自带模版</h2><h3 id="（1）定义与调用"><a href="#（1）定义与调用" class="headerlink" title="（1）定义与调用"></a>（1）定义与调用</h3><ul>
<li><strong>设置模版</strong>：在工程中创建模板目录templates，在settings.py配置文件中修改TEMPLATES配置项的DIRS值</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665997498619-13dd8aa2-0cc6-4480-87d7-1eb237ac29ba.png" alt="img"></p>
<ul>
<li><strong>定义模板</strong>：在templates目录中新建一个模板文件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; city &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>调用模板</strong>：</p>
</li>
<li><ul>
<li>导入模块：<code>from django.template import loader</code></li>
<li>找到模板，返回模板对象：<code>loader.get_template(模板文件路径)</code></li>
<li>渲染模板，返回渲染后的html文本字符串 ：<code>模板对象.render(context=None, request=None)</code></li>
</ul>
</li>
<li><ul>
<li><ul>
<li>context：模板变量字典，默认值为None</li>
<li>request：请求对象，默认值为None</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    template = loader.get_template(<span class="string">&#x27;../templates/index.html&#x27;</span>)</span><br><span class="line">    context = &#123;<span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;杭州&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(template.render(context))</span><br></pre></td></tr></table></figure>

<ul>
<li>Django提供了函数render简写方式：<code>render(request对象, 模板文件路径, 模板数据字典)</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    context = &#123;<span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;武汉&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;../templates/index.html&#x27;</span>,context)</span><br></pre></td></tr></table></figure>

<h3 id="（2）语法"><a href="#（2）语法" class="headerlink" title="（2）语法"></a>（2）语法</h3><ul>
<li><p><strong>模板变量</strong>（模板变量可以使python的内建类型，也可以是对象）</p>
</li>
<li><ul>
<li>变量名必须由字母、数字、下划线（不能以下划线开头）和点组成</li>
<li>变量语法：<code>&#123;&#123;变量&#125;&#125;</code></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;北京&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;adict&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;西游记&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;吴承恩&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;alist&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&#x27;../templates/index.html&#x27;</span>,context)</span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span></span><br><span class="line">          content=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123; city &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123; adict &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123; adict.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123; alist &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;div&gt;&#123;&#123; alist<span class="number">.0</span> &#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>模版语句</strong></p>
</li>
<li><ul>
<li>for循环</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>开始：<code>&#123;% for item in 列表 %&#125;`
    - 循环逻辑

- - - - `&#123;&#123; forloop &#125;&#125;`：有不同选项表示循环顺序
      - `&#123;% empty %&#125;`：列表为空或不存在时执行此逻辑

- - - 结束：`&#123;% endfor %&#125;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% for item in adict %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;forloop&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &#123;&#x27;parentloop&#x27;: &#123;&#125;, &#x27;counter0&#x27;: 0, &#x27;counter&#x27;: 1, &#x27;revcounter&#x27;: 2, &#x27;revcounter0&#x27;: 1, &#x27;first&#x27;: True, &#x27;last&#x27;: False&#125; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;forloop.counter&#125;&#125; &#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>if条件</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>开始：<code>&#123;% if 条件语句 %&#125;`
    - 条件逻辑

- - - - 逻辑1：`&#123;% elif 条件语句 %&#125;`
      - 逻辑2：`&#123;% else 条件语句 %&#125;`

- - - 结束：`&#123;% endif %&#125;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>运算符左右两侧不能紧挨变量或常量，必须有空格</p>
<table>
<thead>
<tr>
<th>比较运算符</th>
<th><code>==``!=</code> <code>&lt;</code> <code>&gt;</code> <code>&lt;=</code> <code>&gt;= </code></th>
</tr>
</thead>
<tbody><tr>
<td>布尔运算符</td>
<td><code>and</code> <code>or</code> <code>not</code></td>
</tr>
</tbody></table>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% if city == &#x27;北京&#x27; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>我们生活在北京<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>我们没有生活在北京<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>注释</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>单行注释语法：&#96;&#96;</li>
<li>多行注释语法：</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li><ul>
<li><ul>
<li>开头：<code>&#123;% comment %&#125;`
      - 结束：`&#123;% endcomment %&#125;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="（3）过滤器"><a href="#（3）过滤器" class="headerlink" title="（3）过滤器"></a>（3）过滤器</h3><ul>
<li><p>过滤器：使用管道符号<code>|</code>来应用过滤器，用于进行计算、转换操作，可以使用在变量、标签中；如果过滤器需要参数，则使用<code>:</code>传递参数，语法：<code>变量|过滤器:参数</code></p>
</li>
<li><p>过滤器：</p>
</li>
<li><ul>
<li>safe：禁用转义，告诉模板变量是安全的，可以解释执行</li>
<li>length：长度，返回字符串包含字符的个数，或列表、元组、字典的元素个数</li>
<li>default：默认值，如果变量不存在时则返回默认值，语法：<code>变量|default:&#39;默认值&#39;</code></li>
<li>date：日期，用于对日期类型的值进行字符串格式化，语法：<code>变量|date:&#39;格式化样式&#39;</code></li>
</ul>
</li>
<li><ul>
<li><ul>
<li>Y：表示年，格式为4位，如2022</li>
<li>y：表示年，格式为2位，如22</li>
<li>m：表示月，格式为数字，如01</li>
<li>M：表示月，格式为汉字，如十月</li>
<li>d：表示日, 格式为数字，如01</li>
<li>D：表示日, 格式为星期，如星期一</li>
<li>j：表示日，格式为数字，如1</li>
<li>H：表示时，24进制</li>
<li>h：表示时，12进制</li>
<li>i：表示分，为0-59</li>
<li>s：表示秒，为0-59</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="（4）模版继承"><a href="#（4）模版继承" class="headerlink" title="（4）模版继承"></a>（4）模版继承</h3><ul>
<li><p>模板继承和类的继承含义是一样的，主要是为了提高代码重用，减轻开发人员的工作量</p>
</li>
<li><p>父模板：如果发现在多个模板中某些内容相同，那就应该把这段内容定义到父模板中</p>
</li>
<li><ul>
<li>标签block：用于在父模板中预留区域，留给子模板填充差异性的内容；为了更好的可读性，建议给标签写上名字</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>开始：<code>&#123;% block 名字%&#125;`
    - 结束：`&#123;% endblock 名字%&#125;</code></li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>父模板中也可以使用上下文中传递过来的数据</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">content</span>=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock title%&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% block main%&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>主要内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endblock main%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block footer%&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>脚注部分<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endblock footer%&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>子模版：子模版不用填充父模版中的所有预留区域，如果子模版没有填充，则使用父模版定义的默认值</p>
</li>
<li><ul>
<li>标签extends：继承，写在子模板文件的第一行，语法：<code>&#123;% extends "父模版路径" %&#125;</code></li>
<li>填充父模板中指定名称的预留区域，直接用指定名字的block标签进行修改即可</li>
<li>获取父模版中block的内容：<code>&#123;&#123; block.super &#125;&#125;</code></li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;fa_index.html&quot; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block main %&#125;</span><br><span class="line">这里是子模版内容</span><br><span class="line">&#123;&#123; block.super &#125;&#125;</span><br><span class="line">&#123;% endblock main %&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-Jinja2模版"><a href="#2-Jinja2模版" class="headerlink" title="2. Jinja2模版"></a>2. Jinja2模版</h2><ul>
<li>Jinja2：是Python下一个被广泛应用的模板引擎，是由Python实现的模板语言，他的设计思想来源于 Django 的模板引擎，并扩展了其语法和一系列强大的功能，尤其是Flask框架内置的模板语言</li>
<li>由于django默认模板引擎功能不齐全，速度慢，所以可以在Django中使用jinja2，jinja2宣称比django默认模板引擎快10-20倍</li>
<li>Django主流的第三方APP基本上也都同时支持Django默认模板及jinja2，所以要用jinja2也不会有多少障碍</li>
</ul>
<h3 id="（1）安装与设置"><a href="#（1）安装与设置" class="headerlink" title="（1）安装与设置"></a>（1）安装与设置</h3><ul>
<li>安装jinja2模块：<code>pip install jinja2</code></li>
<li>在项目文件中创建一个jinja2.py文件，文件中引用Environment</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Environment</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">environment</span>(<span class="params">**options</span>):</span><br><span class="line">    env = Environment(**options)</span><br><span class="line">    <span class="keyword">return</span> env</span><br></pre></td></tr></table></figure>

<ul>
<li><p>修改settings文件</p>
</li>
<li><ul>
<li>TEMPLATES变量修改：<code>&#39;BACKEND&#39;: &#39;django.template.backends.jinja2.Jinja2&#39;</code></li>
<li>OPTIONS键中添加：<code>&#39;environment&#39;:&#39;jinja2文件名.environment&#39;</code></li>
</ul>
</li>
</ul>
<p>注意：需要保留原来的django设置，并放在jinja2设置后面，否则会报错</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1666018989757-272880eb-6cfe-4f25-ace3-5d8d1d2b2a18.png" alt="img"></p>
<h3 id="（2）语法-1"><a href="#（2）语法-1" class="headerlink" title="（2）语法"></a>（2）语法</h3><ul>
<li>jinja2模板语法绝大多数和Django自带模板一样</li>
<li>jinja2中：forloop为loop</li>
</ul>
<table>
<thead>
<tr>
<th><strong>变量</strong></th>
<th><strong>赋值</strong></th>
</tr>
</thead>
<tbody><tr>
<td>loop.index</td>
<td>当前循环迭代的次数（从1开始）</td>
</tr>
<tr>
<td>loop.index0</td>
<td>当前循环迭代的次数（从0开始）</td>
</tr>
<tr>
<td>loop.revindex</td>
<td>当循环结束需要迭代的次数（从1开始）</td>
</tr>
<tr>
<td>loop.revindex0</td>
<td>当循环结束需要迭代的次数（从0开始）</td>
</tr>
<tr>
<td>loop.first</td>
<td>如果是第一次迭代，为True</td>
</tr>
<tr>
<td>loop.last</td>
<td>如果是最后一次迭代，为True</td>
</tr>
<tr>
<td>loop.length</td>
<td>序列中的项目数</td>
</tr>
<tr>
<td>loop.cycle</td>
<td>在一串序列间期取值的辅助函数</td>
</tr>
</tbody></table>
<h3 id="（3）自定义过滤器"><a href="#（3）自定义过滤器" class="headerlink" title="（3）自定义过滤器"></a>（3）自定义过滤器</h3><ul>
<li>在views.py的同级文件夹新建一个python包（包含__init__.py文件）：<code>templatetags</code></li>
<li>在<code>templatetags</code>包下新建一个自定义过滤器文件，并自定义过滤器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line"></span><br><span class="line"><span class="comment"># template.Library实例</span></span><br><span class="line">register = template.Library()</span><br><span class="line"><span class="comment"># 注册过滤器</span></span><br><span class="line"><span class="meta">@register.filter(<span class="params">name=<span class="string">&#x27;do&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">return</span> a+<span class="number">200</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在settings.py中注册自定义过滤器：<code>&#39;应用名.templatetags&#39;</code></li>
<li>在模版文件中使用过滤器，文件最前面需要加上：<code>&#123;% load 自定义过滤器文件名 %&#125;</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load custom_filter %&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;abc|do&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-CSRF"><a href="#3-CSRF" class="headerlink" title="3. CSRF"></a>3. CSRF</h2><ul>
<li>CSRF全拼为Cross Site Request Forgery，译为跨站请求伪造，容易威胁个人隐私以及财产安全</li>
<li>CSRF攻击示意图（客户端访问服务器时没有同服务器做安全验证）</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1665849654246-759cb45d-d8d5-43c0-9bfe-04170b07c185.png" alt="img"></p>
<ul>
<li><strong>防止 CSRF 攻击</strong></li>
</ul>
<p>原理：浏览器的同源策略，网站B获取不到网站A的 cookie ，所以可以解决跨站请求伪造的问题</p>
<ul>
<li><ul>
<li>在客户端向后端请求界面数据的时候，后端会往响应中的 cookie 中设置 csrf_token 的值</li>
<li>在 Form 表单中添加一个隐藏的的字段，值也是 csrf_token</li>
<li>在用户点击提交的时候，会带上这两个值向后台发起请求</li>
<li>后端接受到请求，会做以下两件事：</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>从cookie中取出 csrf_token 的值</li>
<li>从表单数据中取出来隐藏的 csrf_token 的值</li>
</ul>
</li>
</ul>
</li>
<li><ul>
<li>如果比较之后两值一样，那么代表是正常的请求；如果没取到或者比较不一样，代表不是正常的请求，不执行下一步操作</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入生成 csrf_token 的函数</span></span><br><span class="line"><span class="keyword">from</span> django.middleware.csrf <span class="keyword">import</span> get_token</span><br><span class="line">csrf_token = get_token(request)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="comment"># 生成csrf_token</span></span><br><span class="line">        <span class="keyword">from</span> django.middleware.csrf <span class="keyword">import</span> get_token</span><br><span class="line">        csrf_token = get_token(request)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 渲染转换页面，传入 csrf_token 到模板中</span></span><br><span class="line">        response = render(request, <span class="string">&#x27;transfer.html&#x27;</span>,context=&#123;<span class="string">&#x27;csrf_token&#x27;</span>:csrf_token&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 设置csrf_token到cookie中，用于提交校验</span></span><br><span class="line">        response.set_cookie(<span class="string">&#x27;csrf_token&#x27;</span>, csrf_token)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">  &lt;title&gt;转账&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;我是网站A，转账页面&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">  &lt;form method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">&lt;!--     在转账模板表单中添加 csrf_token 隐藏字段 --&gt;</span><br><span class="line">    &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;csrftoken&quot;</span> value=<span class="string">&quot;&#123;&#123; csrf_token &#125;&#125;&quot;</span>&gt;</span><br><span class="line">    &lt;label&gt;账户：&lt;/label&gt;&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;to_account&quot;</span> placeholder=<span class="string">&quot;请输入对方账户&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    &lt;label&gt;金额：&lt;/label&gt;&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;number&quot;</span> name=<span class="string">&quot;money&quot;</span> placeholder=<span class="string">&quot;请输入转账金额&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    &lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;转账&quot;</span>&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="comment"># 取出表单中的 csrf_token</span></span><br><span class="line"> form_csrf_token = request.POST.get(<span class="string">&quot;csrftoken&quot;</span>)</span><br><span class="line"> <span class="comment"># 取出 cookie 中的 csrf_token</span></span><br><span class="line"> cookie_csrf_token = request.COOKIES.get(<span class="string">&#x27;csrf_token&#x27;</span>)</span><br><span class="line"> <span class="comment"># 进行对比</span></span><br><span class="line"> <span class="keyword">if</span> cookie_csrf_token != form_csrf_token:</span><br><span class="line">     <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;token校验失败，可能是非法操作&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在 Django项目中解决 CSRF 攻击</p>
</li>
<li><ul>
<li>Django中开启CSRF（默认开启）</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22414596/1666020265730-ab3ea98c-b7b8-4b8a-b071-f1dd1cea7f6c.png" alt="img"></p>
<ul>
<li><ul>
<li>模板中设置 CSRF 令牌</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% csrf_token %&#125;</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">&lt;<span class="built_in">input</span> <span class="built_in">type</span>=<span class="string">&quot;hidden&quot;</span> value=<span class="string">&quot;&#123;&#123; csrf_token &#125;&#125;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h1 id="附录-参考资料"><a href="#附录-参考资料" class="headerlink" title="附录-参考资料"></a>附录-参考资料</h1><h2 id="官方网站"><a href="#官方网站" class="headerlink" title="官方网站"></a>官方网站</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.djangoproject.com/">官方网站</a></p>
<h2 id="Github源码"><a href="#Github源码" class="headerlink" title="Github源码"></a>Github源码</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/django/django">Github源码</a></p>
<h2 id="4-1版中-x2F-英文文档"><a href="#4-1版中-x2F-英文文档" class="headerlink" title="4.1版中&#x2F;英文文档"></a>4.1版中&#x2F;英文文档</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.djangoproject.com/zh-hans/4.1/">https://docs.djangoproject.com/zh-hans/4.1/</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.djangoproject.com/en/4.1/">https://docs.djangoproject.com/en/4.1/</a></p>
<h2 id="Django-Book教程"><a href="#Django-Book教程" class="headerlink" title="Django Book教程"></a>Django Book教程</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://djangobook.com/">Django Book 教程</a></p>
<h2 id="Tange-With-Django教程"><a href="#Tange-With-Django教程" class="headerlink" title="Tange With Django教程"></a>Tange With Django教程</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.tangowithdjango.com/book17/">Tange With Django 教程</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Wuqiuxu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/post/ca694513.html">http://example.com/post/ca694513.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">妙妙屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Django/">Django</a></div><div class="post_share"><div class="social-share" data-image="/img/django.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/post/3575b0ed.html" title="kafka环境配置及开发"><img class="cover" src="/img/kafka.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">kafka环境配置及开发</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/4b35f5df.html" title="Pandas基本概念及使用指南"><img class="cover" src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-19</div><div class="title">Pandas基本概念及使用指南</div></div></a></div><div><a href="/post/9a55b595.html" title="基于Hexo框架搭建个人博客"><img class="cover" src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-19</div><div class="title">基于Hexo框架搭建个人博客</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Wuqiuxu</div><div class="author-info__description">鸟随鸾凤飞腾远</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Wuqiuxu" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fa-brands fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://i.postimg.cc/660kspWH/image.jpg" rel="external nofollow noreferrer" target="_blank" title="Wechat"><i class="fa-brands fa-weixin" style="color: #05DC6C;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">一、Web应用程序处理流程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Django%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">二、Django简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Django%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.</span> <span class="toc-text">1. Django简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Django%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text">2. Django的特点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Django%E6%B5%81%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">三、Django流程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">1. 创建工程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%AD%90%E5%BA%94%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">2. 创建子应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%A8%A1%E5%9D%97"><span class="toc-number">3.3.</span> <span class="toc-text">3. 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%AB%99%E7%82%B9%E7%AE%A1%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">4. 站点管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E8%A7%86%E5%9B%BE"><span class="toc-number">3.5.</span> <span class="toc-text">5. 视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%A8%A1%E7%89%88"><span class="toc-number">3.6.</span> <span class="toc-text">6. 模版</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%92%8C%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-number">3.7.</span> <span class="toc-text">7. 配置文件和静态文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">四、模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87"><span class="toc-number">4.1.</span> <span class="toc-text">1. 项目准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text">2. 配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B%E7%B1%BB"><span class="toc-number">4.3.</span> <span class="toc-text">3. 定义模型类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%A8%A1%E5%9E%8B%E8%BF%81%E7%A7%BB"><span class="toc-number">4.4.</span> <span class="toc-text">4. 模型迁移</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-shell%E5%B7%A5%E5%85%B7%E5%92%8Cmysql%E6%97%A5%E5%BF%97"><span class="toc-number">4.5.</span> <span class="toc-text">5. shell工具和mysql日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">4.6.</span> <span class="toc-text">6. 数据库操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.7.</span> <span class="toc-text">7. 数据库查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%9F%BA%E7%A1%80%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.7.1.</span> <span class="toc-text">（1）基础条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89F%E5%92%8CQ%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.7.2.</span> <span class="toc-text">（2）F和Q对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E5%92%8C%E6%8E%92%E5%BA%8F%E5%87%BD%E6%95%B0"><span class="toc-number">4.7.3.</span> <span class="toc-text">（3）聚合函数和排序函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.7.4.</span> <span class="toc-text">（4）关联查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%885%EF%BC%89%E6%9F%A5%E8%AF%A2%E9%9B%86QuerySet"><span class="toc-number">4.7.5.</span> <span class="toc-text">（5）查询集QuerySet</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E8%A7%86%E5%9B%BE"><span class="toc-number">5.</span> <span class="toc-text">五、视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-URLconf"><span class="toc-number">5.1.</span> <span class="toc-text">1. URLconf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%B7%AF%E7%94%B1%E5%91%BD%E5%90%8D%E4%B8%8Ereverse%E5%8F%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">2. 路由命名与reverse反解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-HttpRequest%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.3.</span> <span class="toc-text">3. HttpRequest对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89URL%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-number">5.3.1.</span> <span class="toc-text">（1）URL路径参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89Django%E4%B8%AD%E7%9A%84QueryDict%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.3.2.</span> <span class="toc-text">（2）Django中的QueryDict对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-number">5.3.3.</span> <span class="toc-text">（3）请求体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-number">5.3.4.</span> <span class="toc-text">（4）请求头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%885%EF%BC%89%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8HttpRequest%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7"><span class="toc-number">5.3.5.</span> <span class="toc-text">（5）其他常用HttpRequest对象属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-HttpResponse%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.4.</span> <span class="toc-text">4. HttpResponse对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89HttpResponse"><span class="toc-number">5.4.1.</span> <span class="toc-text">（1）HttpResponse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89HttpResponse%E5%AD%90%E7%B1%BB"><span class="toc-number">5.4.2.</span> <span class="toc-text">（2）HttpResponse子类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89JsonResponse"><span class="toc-number">5.4.3.</span> <span class="toc-text">（3）JsonResponse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89redirect%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">5.4.4.</span> <span class="toc-text">（4）redirect重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81"><span class="toc-number">5.5.</span> <span class="toc-text">5. 状态保持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89Cookie"><span class="toc-number">5.5.1.</span> <span class="toc-text">（1）Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89Session"><span class="toc-number">5.5.2.</span> <span class="toc-text">（2）Session</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%B1%BB%E8%A7%86%E5%9B%BE%E4%B8%8E%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">5.6.</span> <span class="toc-text">6. 类视图与中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E7%B1%BB%E8%A7%86%E5%9B%BE"><span class="toc-number">5.6.1.</span> <span class="toc-text">（1）类视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">5.6.2.</span> <span class="toc-text">（2）中间件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%A8%A1%E7%89%88"><span class="toc-number">6.</span> <span class="toc-text">六、模版</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%87%AA%E5%B8%A6%E6%A8%A1%E7%89%88"><span class="toc-number">6.1.</span> <span class="toc-text">1. 自带模版</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%AE%9A%E4%B9%89%E4%B8%8E%E8%B0%83%E7%94%A8"><span class="toc-number">6.1.1.</span> <span class="toc-text">（1）定义与调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E8%AF%AD%E6%B3%95"><span class="toc-number">6.1.2.</span> <span class="toc-text">（2）语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">6.1.3.</span> <span class="toc-text">（3）过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E6%A8%A1%E7%89%88%E7%BB%A7%E6%89%BF"><span class="toc-number">6.1.4.</span> <span class="toc-text">（4）模版继承</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Jinja2%E6%A8%A1%E7%89%88"><span class="toc-number">6.2.</span> <span class="toc-text">2. Jinja2模版</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85%E4%B8%8E%E8%AE%BE%E7%BD%AE"><span class="toc-number">6.2.1.</span> <span class="toc-text">（1）安装与设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E8%AF%AD%E6%B3%95-1"><span class="toc-number">6.2.2.</span> <span class="toc-text">（2）语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">6.2.3.</span> <span class="toc-text">（3）自定义过滤器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-CSRF"><span class="toc-number">6.3.</span> <span class="toc-text">3. CSRF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%99%84%E5%BD%95-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">7.</span> <span class="toc-text">附录-参考资料</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E7%BD%91%E7%AB%99"><span class="toc-number">7.1.</span> <span class="toc-text">官方网站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Github%E6%BA%90%E7%A0%81"><span class="toc-number">7.2.</span> <span class="toc-text">Github源码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1%E7%89%88%E4%B8%AD-x2F-%E8%8B%B1%E6%96%87%E6%96%87%E6%A1%A3"><span class="toc-number">7.3.</span> <span class="toc-text">4.1版中&#x2F;英文文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Django-Book%E6%95%99%E7%A8%8B"><span class="toc-number">7.4.</span> <span class="toc-text">Django Book教程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tange-With-Django%E6%95%99%E7%A8%8B"><span class="toc-number">7.5.</span> <span class="toc-text">Tange With Django教程</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/2c831fb.html" title="Linux概述及常用命令"><img src="https://file.crazywong.com/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux概述及常用命令"/></a><div class="content"><a class="title" href="/post/2c831fb.html" title="Linux概述及常用命令">Linux概述及常用命令</a><time datetime="2023-06-20T14:39:54.000Z" title="发表于 2023-06-20 22:39:54">2023-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/1630b670.html" title="Java常用API"><img src="/img/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java常用API"/></a><div class="content"><a class="title" href="/post/1630b670.html" title="Java常用API">Java常用API</a><time datetime="2023-06-20T13:48:19.000Z" title="发表于 2023-06-20 21:48:19">2023-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/4ea1809c.html" title="Java正则表达式"><img src="/img/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java正则表达式"/></a><div class="content"><a class="title" href="/post/4ea1809c.html" title="Java正则表达式">Java正则表达式</a><time datetime="2023-06-20T13:48:11.000Z" title="发表于 2023-06-20 21:48:11">2023-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/fa358471.html" title="Java反射"><img src="/img/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java反射"/></a><div class="content"><a class="title" href="/post/fa358471.html" title="Java反射">Java反射</a><time datetime="2023-06-20T13:48:00.000Z" title="发表于 2023-06-20 21:48:00">2023-06-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/3a3aa666.html" title="Java网络编程"><img src="/img/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java网络编程"/></a><div class="content"><a class="title" href="/post/3a3aa666.html" title="Java网络编程">Java网络编程</a><time datetime="2023-06-20T13:47:56.000Z" title="发表于 2023-06-20 21:47:56">2023-06-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/default.png')"><div id="footer-wrap"><div class="copyright">&copy;2023 By Wuqiuxu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div></body></html>